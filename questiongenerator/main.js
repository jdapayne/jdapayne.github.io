!function(){"use strict";var t=function(t){for(var e in this.input=null,this.inputDisplay=null,this.slider=null,this.sliderWidth=0,this.sliderLeft=0,this.pointerWidth=0,this.pointerR=null,this.pointerL=null,this.activePointer=null,this.selected=null,this.scale=null,this.step=0,this.tipL=null,this.tipR=null,this.timeout=null,this.valRange=!1,this.values={start:null,end:null},this.conf={target:null,values:null,set:null,range:!1,width:null,scale:!0,labels:!0,tooltip:!0,step:null,disabled:!1,onChange:null},this.cls={container:"rs-container",background:"rs-bg",selected:"rs-selected",pointer:"rs-pointer",scale:"rs-scale",noscale:"rs-noscale",tip:"rs-tooltip"},this.conf)Object.prototype.hasOwnProperty.call(t,e)&&(this.conf[e]=t[e]);this.init()};t.prototype.init=function(){if("object"==typeof this.conf.target?this.input=this.conf.target:this.input=document.getElementById(this.conf.target.replace("#","")),this.input&&(this.inputDisplay=getComputedStyle(this.input,null).display,this.input.style.display="none",this.valRange=!(this.conf.values instanceof Array),!this.valRange||Object.prototype.hasOwnProperty.call(this.conf.values,"min")&&Object.prototype.hasOwnProperty.call(this.conf.values,"max")))return this.createSlider()},t.prototype.createSlider=function(){return this.slider=e("div",this.cls.container),this.slider.innerHTML='<div class="rs-bg"></div>',this.selected=e("div",this.cls.selected),this.pointerL=e("div",this.cls.pointer,["dir","left"]),this.scale=e("div",this.cls.scale),this.conf.tooltip&&(this.tipL=e("div",this.cls.tip),this.tipR=e("div",this.cls.tip),this.pointerL.appendChild(this.tipL)),this.slider.appendChild(this.selected),this.slider.appendChild(this.scale),this.slider.appendChild(this.pointerL),this.conf.range&&(this.pointerR=e("div",this.cls.pointer,["dir","right"]),this.conf.tooltip&&this.pointerR.appendChild(this.tipR),this.slider.appendChild(this.pointerR)),this.input.parentNode.insertBefore(this.slider,this.input.nextSibling),this.conf.width&&(this.slider.style.width=parseInt(this.conf.width)+"px"),this.sliderLeft=this.slider.getBoundingClientRect().left,this.sliderWidth=this.slider.clientWidth,this.pointerWidth=this.pointerL.clientWidth,this.conf.scale||this.slider.classList.add(this.cls.noscale),this.setInitialValues()},t.prototype.setInitialValues=function(){if(this.disabled(this.conf.disabled),this.valRange&&(this.conf.values=i(this.conf)),this.values.start=0,this.values.end=this.conf.range?this.conf.values.length-1:0,this.conf.set&&this.conf.set.length&&n(this.conf)){var t=this.conf.set;this.conf.range?(this.values.start=this.conf.values.indexOf(t[0]),this.values.end=this.conf.set[1]?this.conf.values.indexOf(t[1]):null):this.values.end=this.conf.values.indexOf(t[0])}return this.createScale()},t.prototype.createScale=function(t){this.step=this.sliderWidth/(this.conf.values.length-1);for(var s=0,i=this.conf.values.length;s<i;s++){var n=e("span"),a=e("ins");n.appendChild(a),this.scale.appendChild(n),n.style.width=s===i-1?0:this.step+"px",this.conf.labels?a.innerHTML=this.conf.values[s]:0!==s&&s!==i-1||(a.innerHTML=this.conf.values[s]),a.style.marginLeft=a.clientWidth/2*-1+"px"}return this.addEvents()},t.prototype.updateScale=function(){this.step=this.sliderWidth/(this.conf.values.length-1);for(var t=this.slider.querySelectorAll("span"),e=0,s=t.length;e<s-1;e++)t[e].style.width=this.step+"px";return this.setValues()},t.prototype.addEvents=function(){var t=this.slider.querySelectorAll("."+this.cls.pointer),e=this.slider.querySelectorAll("span");s(document,"mousemove touchmove",this.move.bind(this)),s(document,"mouseup touchend touchcancel",this.drop.bind(this));for(let e=0,i=t.length;e<i;e++)s(t[e],"mousedown touchstart",this.drag.bind(this));for(let t=0,i=e.length;t<i;t++)s(e[t],"click",this.onClickPiece.bind(this));return window.addEventListener("resize",this.onResize.bind(this)),this.setValues()},t.prototype.drag=function(t){if(t.preventDefault(),!this.conf.disabled){var e=t.target.getAttribute("data-dir");return"left"===e&&(this.activePointer=this.pointerL),"right"===e&&(this.activePointer=this.pointerR),this.slider.classList.add("sliding")}},t.prototype.move=function(t){if(this.activePointer&&!this.conf.disabled){this.onResize();var e=("touchmove"===t.type?t.touches[0].clientX:t.pageX)-this.sliderLeft-this.pointerWidth/2;return(e=Math.ceil(e/this.step))<=0&&(e=0),e>this.conf.values.length-1&&(e=this.conf.values.length-1),this.conf.range?(this.activePointer===this.pointerL&&(this.values.start=e),this.activePointer===this.pointerR&&(this.values.end=e)):this.values.end=e,this.setValues()}},t.prototype.drop=function(){this.activePointer=null},t.prototype.setValues=function(t,e){var s=this.conf.range?"start":"end";return t&&this.conf.values.indexOf(t)>-1&&(this.values[s]=this.conf.values.indexOf(t)),e&&this.conf.values.indexOf(e)>-1&&(this.values.end=this.conf.values.indexOf(e)),this.conf.range&&this.values.start>this.values.end&&(this.values.start=this.values.end),this.pointerL.style.left=this.values[s]*this.step-this.pointerWidth/2+"px",this.conf.range?(this.conf.tooltip&&(this.tipL.innerHTML=this.conf.values[this.values.start],this.tipR.innerHTML=this.conf.values[this.values.end]),this.input.value=this.conf.values[this.values.start]+","+this.conf.values[this.values.end],this.pointerR.style.left=this.values.end*this.step-this.pointerWidth/2+"px"):(this.conf.tooltip&&(this.tipL.innerHTML=this.conf.values[this.values.end]),this.input.value=this.conf.values[this.values.end]),this.values.end>this.conf.values.length-1&&(this.values.end=this.conf.values.length-1),this.values.start<0&&(this.values.start=0),this.selected.style.width=(this.values.end-this.values.start)*this.step+"px",this.selected.style.left=this.values.start*this.step+"px",this.onChange()},t.prototype.onClickPiece=function(t){if(!this.conf.disabled){var e=Math.round((t.clientX-this.sliderLeft)/this.step);return e>this.conf.values.length-1&&(e=this.conf.values.length-1),e<0&&(e=0),this.conf.range&&e-this.values.start<=this.values.end-e?this.values.start=e:this.values.end=e,this.slider.classList.remove("sliding"),this.setValues()}},t.prototype.onChange=function(){var t=this;this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){if(t.conf.onChange&&"function"==typeof t.conf.onChange)return t.conf.onChange(t.input.value)}),500)},t.prototype.onResize=function(){return this.sliderLeft=this.slider.getBoundingClientRect().left,this.sliderWidth=this.slider.clientWidth,this.updateScale()},t.prototype.disabled=function(t){this.conf.disabled=t,this.slider.classList[t?"add":"remove"]("disabled")},t.prototype.getValue=function(){return[this.conf.values[this.values.start],this.conf.values[this.values.end]]},t.prototype.getValueL=function(){return this.conf.values[this.values.start]},t.prototype.getValueR=function(){return this.conf.values[this.values.end]},t.prototype.destroy=function(){this.input.style.display=this.inputDisplay,this.slider.remove()};var e=function(t,e,s){var i=document.createElement(t);return e&&(i.className=e),s&&2===s.length&&i.setAttribute("data-"+s[0],s[1]),i},s=function(t,e,s){for(var i=e.split(" "),n=0,a=i.length;n<a;n++)t.addEventListener(i[n],s)},i=function(t){var e=[],s=t.values.max-t.values.min;if(!t.step)return[t.values.min,t.values.max];for(var i=0,n=s/t.step;i<n;i++)e.push(t.values.min+i*t.step);return e.indexOf(t.values.max)<0&&e.push(t.values.max),e},n=function(t){return!t.set||t.set.length<1||t.values.indexOf(t.set[0])<0?null:!t.range||!(t.set.length<2||t.values.indexOf(t.set[1])<0)||null};class a{constructor(t,e){this.x=t,this.y=e}rotate(t){const e=Math.cos(t)*this.x-Math.sin(t)*this.y,s=Math.sin(t)*this.x+Math.cos(t)*this.y;return this.x=e,this.y=s,this}scale(t){return this.x=this.x*t,this.y=this.y*t,this}translate(t,e){return this.x+=t,this.y+=e,this}clone(){return new a(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}moveToward(t,e){const s=a.unitVector(this,t);return this.translate(s.x*e,s.y*e),this}static fromPolar(t,e){return new a(Math.cos(e)*t,Math.sin(e)*t)}static fromPolarDeg(t,e){return e=e*Math.PI/180,a.fromPolar(t,e)}static fromElement(t,e="topleft",s=!0){const i=t.getBoundingClientRect();let n=e.startsWith("top")?i.top:e.startsWith("bottom")?i.bottom:(i.bottom+i.top)/2,o=e.endsWith("left")?i.left:e.endsWith("right")?i.right:(i.right+i.left)/2;if(s&&t.parentElement){const e=a.fromElement(t.parentElement,"topleft",!1);o-=e.x,n-=e.y}return new a(o,n)}static mean(...t){const e=t.map(t=>t.x).reduce((t,e)=>t+e),s=t.map(t=>t.y).reduce((t,e)=>t+e),i=t.length;return new a(e/i,s/i)}static inCenter(t,e,s){const i=a.distance(e,s),n=a.distance(t,s),o=a.distance(t,e),r=i+n+o,h=i*t.x+n*e.x+o*s.x,l=i*t.y+n*e.y+o*s.y;return new a(h/r,l/r)}static min(t){const e=t.reduce((t,e)=>Math.min(t,e.x),1/0),s=t.reduce((t,e)=>Math.min(t,e.y),1/0);return new a(e,s)}static max(t){const e=t.reduce((t,e)=>Math.max(t,e.x),-1/0),s=t.reduce((t,e)=>Math.max(t,e.y),-1/0);return new a(e,s)}static center(t){const e=t.reduce((t,e)=>Math.min(t,e.x),1/0),s=t.reduce((t,e)=>Math.min(t,e.y),1/0),i=t.reduce((t,e)=>Math.max(t,e.x),-1/0),n=t.reduce((t,e)=>Math.max(t,e.y),-1/0);return new a((i+e)/2,(n+s)/2)}static unitVector(t,e){const s=e.x-t.x,i=e.y-t.y,n=Math.hypot(s,i);return{x:s/n,y:i/n}}static distance(t,e){return Math.hypot(t.x-e.x,t.y-e.y)}static angleFrom(t,e){const s=Math.atan2(e.y-t.y,e.x-t.x);return s>=0?s:2*Math.PI+s}static repel(t,e,s,i){const n=Math.hypot(t.x-e.x,t.y-e.y);if(n>=s)return!1;const a=(i-n)/2;return t.moveToward(e,-a),e.moveToward(t,-a),!0}static scaleToFit(t,e,s,i=0,n=[0,0]){let o=a.min(t),r=a.max(t);const h=r.x-o.x,l=r.y-o.y,c=Math.min((e-i)/h,(s-i)/l);t.forEach(t=>{t.scale(c)}),o=a.min(t),r=a.max(t);const d=a.mean(o,r).translate(...n);return t.forEach(t=>{t.translate(e/2-d.x,s/2-d.y)}),c}}function o(t){return()=>function(t){let e=0;for(let s=0;s<t;s++)e+=Math.random();return e/t}(t)}function r(t,e,s){return s||(s=Math.random),t=Math.ceil(t),e=Math.floor(e),t+Math.floor(s()*(e-t+1))}function h(t,e,s){const i=[];for(let n=t;n<e+1;n++)s(n)&&i.push(n);if(0===i.length)throw new Error("overfiltered");return i[r(0,i.length-1)]}function l(t,e,s){return r((t=Math.ceil(t/s)*s)/s,(e=Math.floor(e/s)*s)/s)*s}function c(t,e){if(0===[...t].length)throw new Error("empty array");e||(e=Math.random);const s=r(0,t.length-1,e);return[...t][s]}function d({total:t,n:e,minProportion:s,minValue:i,integer:n=!0}){i=null!=i?i:void 0!==s?t*s:0;const a=[];let o=t;for(let t=0;t<e-1;t++){const s=o-i*(e-t-1),h=n?r(i,s):i+Math.random()*(s-i);o-=h,a.push(h)}return a[e-1]=o,a}function u(t,e){let s=[];const i=Math.sqrt(t/2);for(let n=1;n<i;n++)t/2%n==0&&n*n+t*t/(4*n*n)<=e&&s.push(n);if(0===s.length)throw"2mn no options";let n=c(s),a=t/(2*n);return{a:2*a*n,b:Math.abs(a*a-n*n),c:a*a+n*n}}function m(t,e){let s=[];const i=Math.sqrt((e-t)/2);for(let e=1;e<=i;e++){let i=Math.sqrt(t+e*e);i===Math.floor(i)&&s.push([i,e])}if(0===s.length)throw"n^2-m^2 no options";let[n,a]=c(s);return{a:n*n-a*a,b:2*n*a,c:n*n+a*a}}function p(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function f(t){return Math.sin(t*Math.PI/180)}function g(t,e){if(0===e)return t.toString();const s=Math.pow(10,e),i=Math.floor(t/s),n=t%s;return 0===n?i.toString():i+"."+n}function v(t,e){if(!t)return e;if(!e)return t;for(;;){if(!(t%=e))return e;if(!(e%=t))return t}return 0}function w(t,e){return Array.isArray(t)&&t.includes(e)}function x(t,e,s){const i=document.createElement(t);return e&&(i.className=e),s&&s.appendChild(i),i}function y(t,e){const s=t.getBoundingClientRect(),i=e.getBoundingClientRect();return!(s.right<i.left||s.left>i.right||s.bottom<i.top||s.top>i.bottom)}function b(t,e){if(!y(t,e))return;if("absolute"!==getComputedStyle(t).position||"absolute"!==getComputedStyle(e).position)throw new Error("Only call on position:absolute");let s=a.fromElement(t),i=a.fromElement(e);const n=a.fromElement(t,"center"),o=a.fromElement(e,"center"),r=a.unitVector(n,o),h=t.classList.contains("repel-locked"),l=e.classList.contains("repel-locked");let c=0;for(;y(t,e)&&c<500;)h||s.translate(-r.x,-r.y),l||i.translate(r.x,r.y),t.style.left=s.x+"px",t.style.top=s.y+"px",t.style.transform="none",e.style.left=i.x+"px",e.style.top=i.y+"px",e.style.transform="none",c++;if(500===c)throw new Error("Too much moving")}function C(t,e,s,i,n){const a=Math.hypot(i-e,n-s),o=(s-n)/a,r=(i-e)/a,h=(e+i)/2,l=(s+n)/2;t.moveTo(e,s),t.lineTo(i,n),t.moveTo(h+5*o,l+5*r),t.lineTo(h-5*o,l-5*r),t.moveTo(i,n)}class M{constructor(t,e){this.optionsSpec=t,this.options={},this.optionsSpec.forEach(t=>{L(t)&&"suboptions"!==t.type&&"range"!==t.type?this.options[t.id]=t.default:"range"===t.type?(this.options[t.idLB]=t.defaultLB,this.options[t.idUB]=t.defaultUB):"suboptions"===t.type&&(t.subOptionsSet=new M(t.optionsSpec),this.options[t.id]=t.subOptionsSet.options)}),this.template=e,this.globalId=M.getId()}static getId(){if(M.idCounter>=Math.pow(26,2))throw new Error("Too many options objects!");const t=String.fromCharCode(97+~~(M.idCounter/26))+String.fromCharCode(M.idCounter%26+97);return M.idCounter+=1,t}updateStateFromUI(t){if("string"==typeof t){const e=this.optionsSpec.find(e=>e.id===t);if(void 0===e)throw new Error(`no option with id '${t}'`);t=e}if(!t.element)throw new Error(`option ${t.id} doesn't have a UI element`);switch(t.type){case"int":{const e=t.element.getElementsByTagName("input")[0];this.options[t.id]=Number(e.value);break}case"bool":{const e=t.element.getElementsByTagName("input")[0];this.options[t.id]=e.checked;break}case"select-exclusive":this.options[t.id]=t.element.querySelector("input:checked").value;break;case"select-inclusive":this.options[t.id]=Array.from(t.element.querySelectorAll("input:checked")).map(t=>t.value);break;case"range":{const e=t.element.getElementsByTagName("input")[0],s=t.element.getElementsByTagName("input")[1];this.options[t.idLB]=Number(e.value),this.options[t.idUB]=Number(s.value);break}default:throw new Error(`option with id ${t.id} has unrecognised option type ${t.type}`)}}updateStateFromUIAll(){this.optionsSpec.forEach(t=>{L(t)&&this.updateStateFromUI(t)})}disableOrEnableAll(){this.optionsSpec.forEach(t=>this.disableOrEnable(t))}disableOrEnable(t){if("string"==typeof t){const e=this.optionsSpec.find(e=>L(e)&&e.id===t);if(void 0===e)throw new Error(`no option with id '${t}'`);t=e}if(!L(t)||!t.enabledIf||void 0===t.element)return;const e=t.enabledIf.split("&");let s=!0;for(let t=0;t<e.length;t++){let i=e[t];if(i.startsWith("!")&&(i=i.slice(1)),"boolean"!=typeof this.options[i])throw new Error(`Invalid 'enabledIf': ${i} is not a boolean option`);//! == negate // !== equivalent to XOR
if(!this.options[i]){s=!1;break}}s?(t.element.classList.remove("disabled"),[...t.element.getElementsByTagName("input")].forEach(t=>{t.disabled=!1})):(t.element.classList.add("disabled"),[...t.element.getElementsByTagName("input")].forEach(t=>{t.disabled=!0}))}renderIn(t,e){const s=x("ul","options-list");e&&s.classList.add(e);let i=x("div","options-column",s);return this.optionsSpec.forEach(t=>{if("column-break"===t.type)i=x("div","options-column",s);else if("suboptions"===t.type){const e=t.subOptionsSet;if(void 0===e)throw new Error("This should not happen!");const s=e.renderIn(i,"suboptions");t.element=s}else{const e=x("li",void 0,i);switch(L(t)&&(e.dataset.optionId=t.id),t.type){case"heading":!function(t,e){e.innerHTML=t,e.classList.add("options-heading")}(t.title,e);break;case"int":case"bool":!function(t,e){const s=x("label",void 0,e);t.swapLabel||""===t.title||s.insertAdjacentHTML("beforeend",t.title+": ");const i=x("input","option",s);switch(t.type){case"int":i.type="number",i.min=t.min.toString(),i.max=t.max.toString(),i.value=t.default.toString();break;case"bool":i.type="checkbox",i.checked=t.default;break;default:throw new Error("Typescript is pretty sure I can't get here")}t.swapLabel&&""!==t.title&&s.insertAdjacentHTML("beforeend"," "+t.title)}(t,e);break;case"select-inclusive":case"select-exclusive":this.renderListOption(t,e);break;case"range":!function(t,e){const s=x("label",void 0,e),i=x("input","option",s);i.type="number",i.min=t.min.toString(),i.max=t.max.toString(),i.value=t.defaultLB.toString(),s.insertAdjacentHTML("beforeend",` &leq; ${t.title} &leq; `);const n=x("input","option",s);n.type="number",n.min=t.min.toString(),n.max=t.max.toString(),n.value=t.defaultUB.toString()}(t,e)}e.addEventListener("change",()=>{this.updateStateFromUI(t),this.disableOrEnableAll()}),t.element=e}}),t.append(s),this.disableOrEnableAll(),s}renderWithTemplate(t){this.optionsSpec.forEach(t=>{L(t)&&(undefined[t.id]=t)});this.template}renderListOption(t,e){e.insertAdjacentHTML("beforeend",t.title+": ");const s=x("ul","options-sublist",e);t.vertical&&s.classList.add("options-sublist-vertical"),t.selectOptions.forEach(e=>{const i=x("li",void 0,s),n=x("label",void 0,i),a=document.createElement("input");a.type="select-exclusive"===t.type?"radio":"checkbox",a.name=this.globalId+"-"+t.id,a.value=e.id,"select-inclusive"===t.type?a.checked=t.default.includes(e.id):a.checked=t.default===e.id,n.append(a),a.classList.add("option"),n.insertAdjacentHTML("beforeend",e.title)})}}function L(t){return void 0!==t.id}M.idCounter=0;class S{constructor(){this.DOM=document.createElement("div"),this.DOM.className="question-div",this.answered=!1}getDOM(){return this.DOM}showAnswer(){this.answered=!0}hideAnswer(){this.answered=!1}toggleAnswer(){this.answered?this.hideAnswer():this.showAnswer()}static get commandWord(){return""}}class A extends S{constructor(t,e,s){super(),this.questionLaTeX=t,this.answerLaTeX=e,this.questionp=document.createElement("p"),this.answerp=document.createElement("p"),this.questionp.className="question",(null==s?void 0:s.questionClass)&&this.questionp.classList.add(s.questionClass),this.answerp.className="answer",(null==s?void 0:s.answerClass)&&this.answerp.classList.add(s.answerClass),this.answerp.classList.add("hidden"),this.DOM.appendChild(this.questionp),this.DOM.appendChild(this.answerp)}render(){this.questionLaTeX&&this.answerLaTeX&&(katex.render(this.questionLaTeX,this.questionp,{displayMode:!0,strict:"ignore"}),katex.render(this.answerLaTeX,this.answerp,{displayMode:!0}))}getDOM(){return this.DOM}showAnswer(){this.answerp.classList.remove("hidden"),this.answered=!0}hideAnswer(){this.answerp.classList.add("hidden"),this.answered=!1}}function k(t,e,s){return 0===t&&0===e&&0===s?"0":(0===t?"":1===t?"x^2":-1===t?"-x^2":t+"x^2")+(e<0?"-":0===t||0===e?"":"+")+(0===e?"":1===e||-1===e?"x":Math.abs(e)+"x")+(s<0?"-":0===t&&0===e||0===s?"":"+")+(0===s?"":Math.abs(s))}function q(t,e,s,i){var n=v(t,e);t/=n,e/=n;var a=v(s,i);s/=a,i/=a;var o=!1;return(v(n,a)>1||t===s&&e===i)&&(o=!0),o}class E{constructor(t,e){var s,i;e.width=null!==(s=e.width)&&void 0!==s?s:300,e.height=null!==(i=e.height)&&void 0!==i?i:300,this.width=e.width,this.height=e.height,this.data=t,this.rotation=e.rotation,this.labels=[],this.DOM=x("div","question-div"),this.canvas=x("canvas","question-canvas",this.DOM),this.canvas.width=this.width,this.canvas.height=this.height}getDOM(){return this.DOM}renderLabels(t,e=!0){const s=this.DOM,i=s.getElementsByClassName("label");for(;i.length>0;)i[0].remove();if(this.labels.forEach(e=>{const i=document.createElement("div"),n=document.createElement("div");if(i.classList.add("label"),i.className+=" "+e.style,i.style.left=e.pos.x+"px",i.style.top=e.pos.y+"px",katex.render(e.text,n),i.appendChild(n),s.appendChild(i),n.offsetWidth/n.offsetHeight>2){const t=e.text.replace(/\+/,"\\!+\\!").replace(/-/,"\\!-\\!");katex.render(t,n)}if(t){const t=i.offsetWidth;e.pos.x<this.canvas.width/2-5&&e.pos.x+t/2>this.canvas.width/2&&(i.style.left=this.canvas.width/2-t-3+"px"),e.pos.x>this.canvas.width/2+5&&e.pos.x-t/2<this.canvas.width/2&&(i.style.left=this.canvas.width/2+3+"px")}}),e){const t=[...this.DOM.getElementsByClassName("label")];for(let e=0;e<t.length;e++)for(let s=e+1;s<t.length;s++)b(t[e],t[s])}}showAnswer(){this.labels.forEach(t=>{t.text=t.texta,t.style=t.stylea}),this.renderLabels(!1)}hideAnswer(){this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq}),this.renderLabels(!1)}get allpoints(){return[]}scale(t){this.allpoints.forEach((function(e){e.scale(t)}))}rotate(t){return this.allpoints.forEach((function(e){e.rotate(t)})),t}translate(t,e){this.allpoints.forEach((function(s){s.translate(t,e)}))}randomRotate(){const t=2*Math.PI*Math.random();return this.rotate(t),t}scaleToFit(t,e,s){let i=a.min(this.allpoints),n=a.max(this.allpoints);const o=n.x-i.x,r=n.y-i.y,h=Math.min((t-s)/o,(e-s)/r);this.scale(h),i=a.min(this.allpoints),n=a.max(this.allpoints);const l=a.mean(i,n);return this.translate(t/2-l.x,e/2-l.y),h}}class T extends S{constructor(t,e){super(),this.data=t,this.view=e,this.DOM=this.view.DOM}getDOM(){return this.view.getDOM()}render(){this.view.render()}showAnswer(){super.showAnswer(),this.view.showAnswer()}hideAnswer(){super.hideAnswer(),this.view.hideAnswer()}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function B(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function P(t,e,s){return t(s={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&s.path)}},s.exports),s.exports}var O=B(P((function(t,e){
/**
   * @license Fraction.js v4.0.12 09/09/2015
   * http://www.xarg.org/2014/03/rational-numbers-in-javascript/
   *
   * Copyright (c) 2015, Robert Eisele (robert@xarg.org)
   * Dual licensed under the MIT or GPL Version 2 licenses.
   **/
!function(s){var i={s:1,n:0,d:1};function n(t){function e(){var e=Error.apply(this,arguments);e.name=this.name=t,this.stack=e.stack,this.message=e.message}function s(){}return s.prototype=Error.prototype,e.prototype=new s,e}var a=d.DivisionByZero=n("DivisionByZero"),o=d.InvalidParameter=n("InvalidParameter");function r(t,e){return isNaN(t=parseInt(t,10))&&h(),t*e}function h(){throw new o}var l=function(t,e){var s,n=0,o=1,l=1,c=0,d=0,u=0,m=1,p=1,f=0,g=1,v=1,w=1,x=1e7;if(null==t);else if(void 0!==e)l=(n=t)*(o=e);else switch(typeof t){case"object":"d"in t&&"n"in t?(n=t.n,o=t.d,"s"in t&&(n*=t.s)):0 in t?(n=t[0],1 in t&&(o=t[1])):h(),l=n*o;break;case"number":if(t<0&&(l=t,t=-t),t%1==0)n=t;else if(t>0){for(t>=1&&(t/=p=Math.pow(10,Math.floor(1+Math.log(t)/Math.LN10)));g<=x&&w<=x;){if(t===(s=(f+v)/(g+w))){g+w<=x?(n=f+v,o=g+w):w>g?(n=v,o=w):(n=f,o=g);break}t>s?(f+=v,g+=w):(v+=f,w+=g),g>x?(n=v,o=w):(n=f,o=g)}n*=p}else(isNaN(t)||isNaN(e))&&(o=n=NaN);break;case"string":if(null===(g=t.match(/\d+|./g))&&h(),"-"===g[f]?(l=-1,f++):"+"===g[f]&&f++,g.length===f+1?d=r(g[f++],l):"."===g[f+1]||"."===g[f]?("."!==g[f]&&(c=r(g[f++],l)),(++f+1===g.length||"("===g[f+1]&&")"===g[f+3]||"'"===g[f+1]&&"'"===g[f+3])&&(d=r(g[f],l),m=Math.pow(10,g[f].length),f++),("("===g[f]&&")"===g[f+2]||"'"===g[f]&&"'"===g[f+2])&&(u=r(g[f+1],l),p=Math.pow(10,g[f+1].length)-1,f+=3)):"/"===g[f+1]||":"===g[f+1]?(d=r(g[f],l),m=r(g[f+2],1),f+=3):"/"===g[f+3]&&" "===g[f+1]&&(c=r(g[f],l),d=r(g[f+2],l),m=r(g[f+4],1),f+=5),g.length<=f){l=n=u+(o=m*p)*c+p*d;break}default:h()}if(0===o)throw new a;i.s=l<0?-1:1,i.n=Math.abs(n),i.d=Math.abs(o)};function c(t,e){if(!t)return e;if(!e)return t;for(;;){if(!(t%=e))return e;if(!(e%=t))return t}}function d(t,e){if(!(this instanceof d))return new d(t,e);l(t,e),t=d.REDUCE?c(i.d,i.n):1,this.s=i.s,this.n=i.n/t,this.d=i.d/t}d.REDUCE=1,d.prototype={s:1,n:0,d:1,abs:function(){return new d(this.n,this.d)},neg:function(){return new d(-this.s*this.n,this.d)},add:function(t,e){return l(t,e),new d(this.s*this.n*i.d+i.s*this.d*i.n,this.d*i.d)},sub:function(t,e){return l(t,e),new d(this.s*this.n*i.d-i.s*this.d*i.n,this.d*i.d)},mul:function(t,e){return l(t,e),new d(this.s*i.s*this.n*i.n,this.d*i.d)},div:function(t,e){return l(t,e),new d(this.s*i.s*this.n*i.d,this.d*i.n)},clone:function(){return new d(this)},mod:function(t,e){return isNaN(this.n)||isNaN(this.d)?new d(NaN):void 0===t?new d(this.s*this.n%this.d,1):(l(t,e),0===i.n&&0===this.d&&d(0,0),new d(this.s*(i.d*this.n)%(i.n*this.d),i.d*this.d))},gcd:function(t,e){return l(t,e),new d(c(i.n,this.n)*c(i.d,this.d),i.d*this.d)},lcm:function(t,e){return l(t,e),0===i.n&&0===this.n?new d:new d(i.n*this.n,c(i.n,this.n)*c(i.d,this.d))},ceil:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new d(NaN):new d(Math.ceil(t*this.s*this.n/this.d),t)},floor:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new d(NaN):new d(Math.floor(t*this.s*this.n/this.d),t)},round:function(t){return t=Math.pow(10,t||0),isNaN(this.n)||isNaN(this.d)?new d(NaN):new d(Math.round(t*this.s*this.n/this.d),t)},inverse:function(){return new d(this.s*this.d,this.n)},pow:function(t){return t<0?new d(Math.pow(this.s*this.d,-t),Math.pow(this.n,-t)):new d(Math.pow(this.s*this.n,t),Math.pow(this.d,t))},equals:function(t,e){return l(t,e),this.s*this.n*i.d==i.s*i.n*this.d},compare:function(t,e){l(t,e);var s=this.s*this.n*i.d-i.s*i.n*this.d;return(0<s)-(s<0)},simplify:function(t){if(isNaN(this.n)||isNaN(this.d))return this;var e=this.abs().toContinued();function s(t){return 1===t.length?new d(t[0]):s(t.slice(1)).inverse().add(t[0])}t=t||.001;for(var i=0;i<e.length;i++){var n=s(e.slice(0,i+1));if(n.sub(this.abs()).abs().valueOf()<t)return n.mul(this.s)}return this},divisible:function(t,e){return l(t,e),!(!(i.n*this.d)||this.n*i.d%(i.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(t){var e,s="",i=this.n,n=this.d;return this.s<0&&(s+="-"),1===n?s+=i:(t&&(e=Math.floor(i/n))>0&&(s+=e,s+=" ",i%=n),s+=i,s+="/",s+=n),s},toLatex:function(t){var e,s="",i=this.n,n=this.d;return this.s<0&&(s+="-"),1===n?s+=i:(t&&(e=Math.floor(i/n))>0&&(s+=e,i%=n),s+="\\frac{",s+=i,s+="}{",s+=n,s+="}"),s},toContinued:function(){var t,e=this.n,s=this.d,i=[];if(isNaN(this.n)||isNaN(this.d))return i;do{i.push(Math.floor(e/s)),t=e%s,e=s,s=t}while(1!==e);return i},toString:function(t){var e,s=this.n,i=this.d;if(isNaN(s)||isNaN(i))return"NaN";d.REDUCE||(s/=e=c(s,i),i/=e),t=t||15;var n=function(t,e){for(;e%2==0;e/=2);for(;e%5==0;e/=5);if(1===e)return 0;for(var s=10%e,i=1;1!==s;i++)if(s=10*s%e,i>2e3)return 0;return i}(0,i),a=function(t,e,s){for(var i=1,n=function(t,e,s){for(var i=1;e>0;t=t*t%s,e>>=1)1&e&&(i=i*t%s);return i}(10,s,e),a=0;a<300;a++){if(i===n)return a;i=10*i%e,n=10*n%e}return 0}(0,i,n),o=-1===this.s?"-":"";if(o+=s/i|0,s%=i,(s*=10)&&(o+="."),n){for(var r=a;r--;)o+=s/i|0,s%=i,s*=10;o+="(";for(r=n;r--;)o+=s/i|0,s%=i,s*=10;o+=")"}else for(r=t;s&&r--;)o+=s/i|0,s%=i,s*=10;return o}},Object.defineProperty(e,"__esModule",{value:!0}),d.default=d,d.Fraction=d,t.exports=d}()})));class _{constructor(t,e){!isNaN(t)&&e instanceof Map?(this.c=t,this.vs=e):"string"==typeof t?this.initStr(t):isNaN(t)?(this.c=4,this.vs=new Map([["x",2],["y",1]])):(this.c=t,this.vs=new Map)}clone(){const t=new Map(this.vs);return new _(this.c,t)}mul(t){t instanceof _||(t=new _(t));const e=this.c*t.c;let s=new Map;return this.vs.forEach((e,i)=>{t.vs.has(i)?s.set(i,this.vs.get(i)+t.vs.get(i)):s.set(i,this.vs.get(i))}),t.vs.forEach((e,i)=>{s.has(i)||s.set(i,t.vs.get(i))}),s=new Map([...s.entries()].sort()),new _(e,s)}toLatex(){if(0===this.vs.size)return this.c.toString();let t=1===this.c?"":-1===this.c?"-":this.c.toString();return this.vs.forEach((e,s)=>{t+=1===e?s:s+"^"+e}),t}sort(){this.vs=new Map([...this.vs.entries()].sort())}cleanZeros(){this.vs.forEach((t,e)=>{0===t&&this.vs.delete(e)})}like(t){t instanceof _||(t=new _(t));let e=!0;return this.vs.forEach((s,i)=>{t.vs.has(i)&&t.vs.get(i)===s||(e=!1)}),t.vs.forEach((t,s)=>{this.vs.has(s)&&this.vs.get(s)===t||(e=!1)}),e}add(t,e){if(t instanceof _||(t=new _(t)),void 0===e&&(e=!0),e&&!this.like(t))throw new Error("Adding unlike terms");const s=this.c+t.c,i=this.vs;return new _(s,i)}initStr(t){const e=t.match(/^-?\d*/)[0],s=""===e?1:"-"===e?-1:parseInt(e);let i=t.match(/([a-zA-Z])(\^\d+)?/g);i||(i=[]);for(let t=0;t<i.length;t++){const e=i[t].split("^");e[1]=e[1]?parseInt(e[1]):1,i[t]=e}i=i.filter(t=>0!==t[1]),this.c=s,this.vs=new Map(i)}static var(t){const e=new Map([[t,1]]);return new _(1,e)}}class N{constructor(t){Array.isArray(t)&&t[0]instanceof _?(t.map(t=>t.clone()),this.terms=t):isNaN(t)?"string"==typeof t&&this.initStr(t):this.initNum(t)}initStr(t){t=(t=(t=t.replace(/\+-/g,"-")).replace(/-/g,"+-")).replace(/\s/g,""),this.terms=t.split("+").map(t=>new _(t)).filter(t=>0!==t.c)}initNum(t){this.terms=[new _(t)]}toLatex(){let t="";for(let e=0;e<this.terms.length;e++)e>0&&this.terms[e].c>=0&&(t+="+"),t+=this.terms[e].toLatex();return t}toString(){return this.toLaTeX()}clone(){const t=this.terms.map(t=>t.clone());return new N(t)}simplify(){const t=this.terms.slice();let e=[];for(let s=0;s<t.length;s++){if(!t[s])continue;let i=t[s];for(let e=s+1;e<t.length;e++)t[e]&&t[e].like(t[s])&&(i=i.add(t[e]),t[e]=null);e.push(i),t[s]=null}return e=e.filter(t=>0!==t.c),new N(e)}add(t,e){t instanceof N||(t=new N(t)),void 0===e&&(e=!0);const s=this.terms.concat(t.terms);let i=new N(s);return e&&(i=i.simplify()),i}mul(t,e){t instanceof N||(t=new N(t));const s=[];void 0===e&&(e=!0);for(let e=0;e<this.terms.length;e++)for(let i=0;i<t.terms.length;i++)s.push(this.terms[e].mul(t.terms[i]));let i=new N(s);return e&&(i=i.simplify()),i}pow(t,e){let s=this;for(let e=1;e<t;e++)s=s.mul(this);return e&&(s=s.simplify()),s}static var(t){const e=[_.var(t)];return new N(e)}static x(){return N.var("x")}static const(t){return new N(t)}}class D extends T{constructor(t){const e=new I(t);super(e,new F(e,t))}static get commandWord(){return"Complete the arithmagon:"}}D.optionsSpec=[{title:"Vertices",id:"n",type:"int",min:3,max:20,default:3},{title:"Type",id:"type",type:"select-exclusive",selectOptions:[{title:"Integer (+)",id:"integer-add"},{title:"Integer (×)",id:"integer-multiply"},{title:"Fraction (+)",id:"fraction-add"},{title:"Fraction (×)",id:"fraction-multiply"},{title:"Algebra (+)",id:"algebra-add"},{title:"Algebra (×)",id:"algebra-multiply"}],default:"integer-add",vertical:!0},{title:"Puzzle type",type:"select-exclusive",id:"puz_diff",selectOptions:[{title:"Missing edges",id:"1"},{title:"Mixed",id:"2"},{title:"Missing vertices",id:"3"}],default:"1"}];class I{constructor(t){switch(this.settings=Object.assign({},{n:3,min:-20,max:20,num_diff:1,puz_diff:1,type:"integer-add"},this.settings,t),this.settings.num_diff=this.settings.difficulty,this.settings.puz_diff=parseInt(this.settings.puz_diff),//! ? This should have been done upstream...
this.n=this.settings.n,this.vertices=[],this.sides=[],this.settings.type.endsWith("add")?(this.opname="+",this.op=(t,e)=>t.add(e)):this.settings.type.endsWith("multiply")&&(this.opname="×",this.op=(t,e)=>t.mul(e)),this.settings.type){case"integer-add":case"integer-multiply":this.initInteger(this.settings);break;case"fraction-add":this.initFractionAdd(this.settings);break;case"fraction-multiply":this.initFractionMultiply(this.settings);break;case"algebra-add":this.initAlgebraAdd(this.settings);break;case"algebra-multiply":this.initAlgebraMultiply(this.settings);break;default:throw new Error("Unexpected switch default")}this.calculateEdges(),this.hideLabels(this.settings.puz_diff)}initInteger(t){for(let e=0;e<this.n;e++)this.vertices[e]={val:new O(h(t.min,t.max,e=>t.type.endsWith("add")||0!==e)),hidden:!1}}initFractionAdd(t){const e=t.num_diff;if(e<3){const t=c([5,7,9,11,13,17]);for(let s=0;s<this.n;s++){const i=this.vertices[s-1]?this.vertices[s-1].val.n:void 0,n=this.vertices[(s+1)%this.n]?this.vertices[(s+1)%this.n].val.n:void 0,a=h(1,2===e?t-1:n?t-Math.max(n,i):i?t-i:t-1,e=>!(1!==v(e,t)||i&&1!==v(e+i,t)&&e+i!==t||n&&1!==v(e+n,t)&&e+n!==t));this.vertices[s]={val:new O(a,t),hidden:!1}}}else{const t=c(e<7?[2,3,5]:[2,3,4,5,6,7,8,9,10,11]);for(let s=0;s<this.n;s++){const i=this.vertices[s-1]?this.vertices[s-1].val:void 0,n=this.vertices[(s+1)%this.n]?this.vertices[(s+1)%this.n].val:void 0,a=e<7?4:8,o=s%2==1||e>4?h(2,a,e=>!(i&&e===i.d/t||n&&e===n.d/t)):1,r=t*o;let l;l=e<6?h(1,r-1,t=>1===v(t,r)&&(e>=4||!i||i.add(t,r)<=1)&&(e>=4||!n||n.add(t,r)<=1)):e<8?h(r+1,6*r,t=>1===v(t,r)):h(10*r,100*r,t=>1===v(t,r)),this.vertices[s]={val:new O(l,r),hidden:!1}}}}initFractionMultiply(t){for(let t=0;t<this.n;t++){const e=r(2,10),s=r(1,e-1);this.vertices[t]={val:new O(s,e),hidden:!1}}}initAlgebraAdd(t){switch(t.num_diff){case 1:{const t=String.fromCharCode(r(97,122));for(let e=0;e<this.n;e++){const s=r(1,10).toString();this.vertices[e]={val:new N(s+t),hidden:!1}}}break;case 2:default:if(Math.random()<.5){const t=String.fromCharCode(r(97,122));for(let e=0;e<this.n;e++){const s=r(1,10).toString(),i=r(1,10).toString();this.vertices[e]={val:new N(s+t+"+"+i),hidden:!1}}}else{const t=String.fromCharCode(r(97,122));let e=t;for(;e===t;)e=String.fromCharCode(r(97,122));for(let s=0;s<this.n;s++){const i=r(1,10).toString(),n=r(1,10).toString();this.vertices[s]={val:new N(i+t+"+"+n+e),hidden:!1}}}}}initAlgebraMultiply(t){const e=t.num_diff;switch(e){case 1:{const t=String.fromCharCode(r(97,122));for(let e=0;e<this.n;e++){const s=r(1,10).toString(),i=e%2==0?s:s+t;this.vertices[e]={val:new N(i),hidden:!1}}break}case 2:{const t=String.fromCharCode(r(97,122)),e=String.fromCharCode(r(97,122));for(let s=0;s<this.n;s++){const i=r(1,10).toString(),n=c([t,e]);this.vertices[s]={val:new N(i+n),hidden:!1}}break}case 3:{const t=String.fromCharCode(r(97,122));for(let e=0;e<this.n;e++){const s=r(1,10).toString(),i=r(1,3).toString();this.vertices[e]={val:new N(s+t+"^"+i),hidden:!1}}break}case 4:{const t=r(97,120),e=String.fromCharCode(t),s=String.fromCharCode(t+1),i=String.fromCharCode(t+2);for(let t=0;t<this.n;t++){const n=r(1,10).toString()+e+("^"+r(0,3).toString())+s+("^"+r(0,3).toString())+i+("^"+r(0,3).toString());this.vertices[t]={val:new N(n),hidden:!1}}break}case 5:case 6:{const t=String.fromCharCode(r(97,122));for(let s=0;s<this.n;s++){const i=r(1,10).toString(),n=r(-9,9).toString();let a=i;6!==e&&s%2!=1||(a+=t),s%2==1&&(a+="+"+n),this.vertices[s]={val:new N(a),hidden:!1}}break}case 7:{const t=r(97,120),e=String.fromCharCode(t),s=String.fromCharCode(t+1);for(let t=0;t<this.n;t++){let i=r(1,10).toString()+e+("^"+r(0,3).toString())+s+("^"+r(0,3).toString());if(t%2==1){i+="+"+r(-9,9).toString()+e+("^"+r(0,3).toString())+s+("^"+r(0,3).toString())}this.vertices[t]={val:new N(i),hidden:!1}}break}case 8:default:{const t=String.fromCharCode(r(97,122));for(let e=0;e<this.n;e++){const s=r(-9,9).toString();this.vertices[e]={val:new N(t+"+"+s),hidden:!1}}}}}calculateEdges(){for(let t=0;t<this.n;t++)this.sides[t]={val:this.op(this.vertices[t].val,this.vertices[(t+1)%this.n].val),hidden:!1}}hideLabels(t){switch(t){case 1:this.sides.forEach(t=>{t.hidden=!0});break;case 2:{this.sides.forEach(t=>{t.hidden=!0});const t=r(0,this.n-1,Math.random),e=Math.random()<.5?t:(t+1)%this.n;this.sides[t].hidden=!1,this.vertices[e].hidden=!0;break}case 3:this.vertices.forEach(t=>{t.hidden=!0});break;default:throw new Error("no_difficulty")}}}class F extends E{constructor(t,e){super(t,e);const s=this.width,i=this.height,n=.35*Math.min(s,i),o=this.data.n;this.operationPoint=new a(0,0),this.vertexPoints=[];for(let t=0;t<o;t++){const e=t*Math.PI*2/o-Math.PI/2;this.vertexPoints[t]=a.fromPolar(n,e)}this.sidePoints=[];for(let t=0;t<o;t++)this.sidePoints[t]=a.mean(this.vertexPoints[t],this.vertexPoints[(t+1)%o]);this.allPoints=[this.operationPoint].concat(this.vertexPoints).concat(this.sidePoints),this.reCenter(),this.makeLabels(!0)}reCenter(){const t=a.min(this.allPoints),e=a.max(this.allPoints),s=a.mean(t,e);this.allPoints.forEach(t=>{t.translate(this.width/2-s.x,this.height/2-s.y)})}makeLabels(){this.data.vertices.forEach((t,e)=>{const s=t.val.toLatex?t.val.toLatex(!0):t.val.toString();this.labels.push({pos:this.vertexPoints[e],textq:t.hidden?"":s,texta:s,styleq:"normal vertex",stylea:t.hidden?"answer vertex":"normal vertex"})}),this.data.sides.forEach((t,e)=>{const s=t.val.toLatex?t.val.toLatex(!0):t.val.toString();this.labels.push({pos:this.sidePoints[e],textq:t.hidden?"":s,texta:s,styleq:"normal side",stylea:t.hidden?"answer side":"normal side"})}),this.labels.push({pos:this.operationPoint,textq:this.data.opname,texta:this.data.opname,styleq:"normal",stylea:"normal"}),this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq})}render(){const t=this.canvas.getContext("2d"),e=this.data.n;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.beginPath();for(let s=0;s<e;s++){const i=this.vertexPoints[s],n=this.vertexPoints[(s+1)%e];t.moveTo(i.x,i.y),t.lineTo(n.x,n.y)}t.stroke(),t.closePath(),this.renderLabels(!0)}showAnswer(){this.labels.forEach(t=>{t.text=t.texta,t.style=t.stylea}),this.renderLabels(!0),this.answered=!0}hideAnswer(){this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq}),this.renderLabels(!0),this.answered=!1}}class W extends E{constructor(t,e){super(t,e);const s=this.width,i=this.height,n=this.radius=Math.min(s,i)/2.5,o=e.minViewAngle||25;this.viewAngles=function(t,e){const s=t.reduce((t,e)=>t+e),i=t.map((t,e)=>[t,e]),n=i.filter(t=>t[0]<e),a=i.filter(t=>t[0]>=e),o=a.reduce((t,e)=>t+e[0],0);n.forEach(t=>{const s=e-t[0];t[0]+=s,a.forEach(t=>{const e=s*t[0]/o;t[0]=Math.round(t[0]-e)})});const r=n.concat(a).sort((t,e)=>t[1]-e[1]).map(t=>t[0]);let h=r.reduce((t,e)=>t+e);if(h!==s){const t=s-h;r[r.indexOf(Math.max(...r))]+=t}if(h=r.reduce((t,e)=>t+e),h!==s)throw new Error(`Didn't fix angles. New sum is ${h}, but should be ${s}`);return r}(this.data.angles,o),this.O=new a(0,0),this.A=new a(n,0),this.C=[];let r=0;for(let t=0;t<this.data.angles.length;t++)r+=this.viewAngles[t]*Math.PI/180,this.C[t]=a.fromPolar(n,r);this.rotation=void 0!==e.rotation?this.rotate(e.rotation):this.randomRotate(),this.translate(s/2,i/2),r=180*a.angleFrom(this.O,this.A)/Math.PI;for(let t=0;t<this.viewAngles.length;t++){const e={},s=this.data.angleLabels[t],i=p(this.data.angles[t],2).toString()+"^\\circ",o=this.viewAngles[t],h=.4+6/o;e.pos=a.fromPolarDeg(n*h,r+o/2).translate(this.O.x,this.O.y),e.textq=s,e.styleq="normal",this.data.missing[t]?(e.texta=i,e.stylea="answer"):(e.texta=e.textq,e.stylea=e.styleq),e.text=e.textq,e.style=e.styleq,this.labels[t]=e,r+=o}this.labels.forEach(t=>{t.text=t.textq,t.style=t.styleq})}render(){const t=this.canvas.getContext("2d");if(null===t)throw new Error("Could not get canvas context");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.beginPath(),t.moveTo(this.O.x,this.O.y),t.lineTo(this.A.x,this.A.y);for(let e=0;e<this.C.length;e++)t.moveTo(this.O.x,this.O.y),t.lineTo(this.C[e].x,this.C[e].y);t.strokeStyle="gray",t.stroke(),t.closePath(),t.beginPath();let e=this.rotation;for(let s=0;s<this.viewAngles.length;s++){const i=this.viewAngles[s]*Math.PI/180;t.arc(this.O.x,this.O.y,this.radius*(.2+.07/i),e,e+i),t.stroke(),e+=i}t.closePath(),this.renderLabels(!1)}get allpoints(){let t=[this.A,this.O];return t=t.concat(this.C),this.labels.forEach((function(e){t.push(e.pos)})),t}}class ${constructor(t,e,s,i){if(e===[])throw new Error("Must give angles");if(Math.round(e.reduce((t,e)=>t+e))!==t)throw new Error("Angle sum must be "+t);this.angles=e,this.missing=s,this.angleSum=t,this.angleLabels=i||[]}static random(t){let e;return e=t.repeated?this.randomRepeated(t):this.randomSimple(t),e.initLabels(),e}static randomSimple(t){const e=t.angleSum,s=r(t.minN,t.maxN),i=t.minAngle;if(s<2)throw new Error("Can't have missing fewer than 2 angles");const n=d({total:e,n:s,minValue:i}),a=[];return a.length=s,a.fill(!1),a[r(0,s-1)]=!0,new this(e,n,a)}static randomRepeated(t){const e=t.angleSum,s=t.minAngle,i=r(t.minN,t.maxN),n=t.nMissing||(Math.random()<.1?i:r(2,i-1));if(i<2||n<1||n>i)throw new Error(`Invalid arguments: n=${i}, m=${n}`);if(i===n){const t=[];t.length=i,t.fill(e/i);const s=[];return s.length=i,s.fill(!0),new this(e,t,s)}const a=[],o=[];o.length=i,o.fill(!1);const h=r(s,(e-s*(i-n))/n),l=[];let c=e-h*n;for(let t=0;t<i-n-1;t++){const e=r(s,c-s*(i-n-t-1));c-=e,l.push(e)}l[i-n-1]=c;{let t=0;for(;t<n;){const e=r(0,i-1);!1===o[e]&&(o[e]=!0,a[e]=h,t++)}}{let t=0;for(let e=0;e<i;e++)!1===o[e]&&(a[e]=l[t],t++)}return new this(e,a,o)}initLabels(){const t=this.angles.length;for(let e=0;e<t;e++)this.missing[e]?this.angleLabels[e]="x^\\circ":this.angleLabels[e]=this.angles[e].toString()+"^\\circ"}}class R extends T{static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:15,minN:2,maxN:4,repeated:!1,nMissing:3},t),i=$.random(s),n=new W(i,e);return new R(i,n)}static get commandWord(){return"Find the missing value"}}class H extends E{constructor(t,e){super(t,e);const s=this.width,i=this.height;this.A=new a(0,0),this.B=a.fromPolarDeg(1,t.angles[0]),this.C=new a(f(this.data.angles[1])/f(this.data.angles[2]),0);const n=a.inCenter(this.A,this.B,this.C);for(let t=0;t<3;t++){const e=[this.A,this.B,this.C][t],s={textq:this.data.angleLabels[t],text:this.data.angleLabels[t],styleq:"normal",style:"normal",pos:a.mean(e,e,n)};this.data.missing[t]?(s.texta=p(this.data.angles[t],2).toString()+"^\\circ",s.stylea="answer"):(s.texta=s.textq,s.stylea=s.styleq),this.labels[t]=s}this.rotation=void 0!==e.rotation?this.rotate(e.rotation):this.randomRotate();let o=a.min([this.A,this.B,this.C]),r=a.max([this.A,this.B,this.C]);const h=r.x-o.x,l=r.y-o.y;this.scale(Math.min((s-0)/h,(i-0)/l)),o=a.min([this.A,this.B,this.C]),r=a.max([this.A,this.B,this.C]);const c=a.mean(o,r);this.translate(s/2-c.x,i/2-c.y)}render(){const t=this.canvas.getContext("2d");if(null===t)throw new Error("Could not get canvas context");const e=[this.A,this.B,this.C],s=this.data.apex;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.beginPath(),t.moveTo(this.A.x,this.A.y);for(let i=0;i<3;i++){const n=e[i],a=e[(i+1)%3];s===i||s===(i+1)%3?C(t,n.x,n.y,a.x,a.y):t.lineTo(a.x,a.y)}t.strokeStyle="gray",t.stroke(),t.closePath(),this.renderLabels(!1)}get allpoints(){const t=[this.A,this.B,this.C];return this.labels.forEach(e=>{t.push(e.pos)}),t}}class j extends ${constructor(t,e,s,i,n){super(t,e,s,i),this.apex=n}static randomRepeated(t){t.nMissing=2,t.givenAngle=t.givenAngle||Math.random()<.5?"apex":"base";const e=super.randomRepeated(t);return e.apex=function(t){let e=0;for(;e<t.length&&t.indexOf(t[e])!==t.lastIndexOf(t[e]);)e++;return e}(e.angles),e.missing=[!0,!0,!0],"apex"===t.givenAngle?e.missing[e.apex]=!1:e.missing[(e.apex+1)%3]=!1,e.initLabels(),e}initLabels(){const t=this.angles.length;let e=0;for(let s=0;s<t;s++)this.missing[s]?(this.angleLabels[s]=String.fromCharCode(120+e)+"^\\circ",e++):this.angleLabels[s]=this.angles[s].toString()+"^\\circ"}}class X extends T{static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:15,minN:2,maxN:4,repeated:!1,nMissing:1},t,{angleSum:180,minAngle:25,minN:3,maxN:3}),i=j.random(s),n=new H(i,e);return new X(i,n)}static get commandWord(){return"Find the missing value"}}class V{constructor(t,e){this.a=t,this.b=e}isConstant(){return 0===this.a}toString(){let t="";return 1===this.a?t+="x":-1===this.a?t+="-x":0!==this.a&&(t+=this.a+"x"),0!==this.a&&this.b>0?t+=" + ":0!==this.a&&this.b<0&&(t+=" - "),this.b>0||this.b<0&&0===this.a?t+=this.b:this.b<0&&(t+=Math.abs(this.b)),t}toStringP(){return 0===this.a||0===this.b?this.toString():"("+this.toString()+")"}eval(t){return this.a*t+this.b}add(t){return void 0!==t.a?new V(this.a+t.a,this.b+t.b):new V(this.a,this.b+t)}times(t){return new V(this.a*t,this.b*t)}static solve(t,e){return(e.b-t.b)/(t.a-e.a)}}function z(t,e){const s=t.reduce((t,e)=>t.add(e)),i=V.solve(s,new V(0,e)),n=[];return t.forEach((function(t){if(t.eval(i)<=0)throw new Error("negative angle");n.push(t.eval(i))})),{x:i,angles:n}}class U{constructor(t,e,s,i,n){this.angles=t,this.angleSum=s,this.angleLabels=i,this.x=n,this.missing=e}static random(t){t.maxConstant=t.maxConstant||t.angleSum/2,t.maxXValue=t.maxXValue||t.angleSum/4;const e=r(t.minN,t.maxN);let s;switch(c(t.expressionTypes)){case"mixed":s=function(t,e){const s=[],i=r(e.minXValue,e.maxXValue);let n=e.angleSum,a=!0;for(let o=0;o<t-1;o++){const h=r(1,e.maxCoefficient);n-=h*i;const l=Math.min(n-e.minAngle*(t-o-1),e.maxConstant),c=r(e.minAngle-h*i,l);0!==h&&(a=!1),n-=c,s.push(new V(h,c))}const o=r(a?1:e.minCoefficient,e.maxCoefficient),h=n-o*i;return s.push(new V(o,h)),s}(e,t);break;case"multiply":s=function(t,e){const s=[],i=!0===e.includeConstants||w(e.includeConstants,"mult");2===t&&e.ensureX&&i&&(t=3);let n=t;const a=i?r(t,(e.angleSum-e.minAngle)/e.minAngle,Math.random):c([3,4,5,6,8,9,10].filter(e=>e>=t),Math.random);let o=a;if(i){n--;const t=l(a*e.minAngle,e.angleSum-e.minAngle,a),i=e.angleSum-t;s.push(new V(0,i))}e.ensureX&&(n--,s.push(new V(1,0)),o-=1);for(;n>1;){n--;const t=r(1,o-n);s.push(new V(t,0)),o-=t}return s.push(new V(o,0)),s}(e,t);break;case"add":default:s=function(t,e){const s=[],i=!0===e.includeConstants||w(e.includeConstants,"add");2===t&&e.ensureX&&i&&(t=3);const n=r(e.minXValue,e.maxXValue);let a=e.angleSum,o=t;e.ensureX&&(o--,s.push(new V(1,0)),a-=n);if(i){o--;const t=r(e.minAngle,a-e.minAngle*o);s.push(new V(0,t)),a-=t}for(;o>1;){o--,a-=n;const t=Math.min(a-e.minAngle*o,e.maxConstant),i=r(Math.max(e.minAngle-n,-e.maxConstant),t);s.push(new V(1,i)),a-=i}return s.push(new V(1,a-n)),s}(e,t)}s=function(t){for(var e,s,i=t.length;0!==i;)s=Math.floor(Math.random()*i),e=t[i-=1],t[i]=t[s],t[s]=e;return t}(s);const{x:i,angles:n}=z(s,t.angleSum),a=s.map(t=>t.toStringP()+"^\\circ"),o=s.map(t=>!t.isConstant());return new U(n,o,t.angleSum,a,i)}initLabels(){}}class G extends W{constructor(t,e){super(t,e);const s={pos:new a(10,this.height-10),textq:"",texta:`x = ${this.data.x}^\\circ`,styleq:"hidden",stylea:"extra-answer"};s.style=s.styleq,s.text=s.textq,this.labels.push(s)}}class Y extends T{static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:15,minN:2,maxN:4,repeated:!1,expressionTypes:["add","multiply","mixed"],ensureX:!0,includeConstants:!0,minCoefficient:1,maxCoefficient:4,minXValue:15},t),i=U.random(s),n=new G(i,e);return new Y(i,n)}static get commandWord(){return"Find the missing value"}static get optionsSpec(){return[{id:"expressionTypes",type:"select-inclusive",title:"Types of expression",selectOptions:[{title:"<em>a</em>+<em>x</em>",id:"add"},{title:"<em>ax</em>",id:"multiply"},{title:"mixed",id:"mixed"}],default:["add","multiply","mixed"]},{id:"ensureX",type:"bool",title:"Ensure one angle is <em>x</em>",default:!0},{id:"includeConstants",type:"bool",title:"Ensure a constant angle",default:!0}]}}class Z extends H{constructor(t,e){super(t,e);const s={pos:new a(10,this.height-10),textq:"",texta:`x = ${this.data.x}^\\circ`,styleq:"hidden",stylea:"extra-answer"};s.style=s.styleq,s.text=s.textq,this.labels.push(s)}}class Q extends T{static random(t,e){const s=Object.assign({},{angleSum:180,minN:3,maxN:3,repeated:!1,minAngle:25,expressionTypes:["add","multiply","mixed"],ensureX:!0,includeConstants:!0,minCoefficient:1,maxCoefficient:4,minXValue:15},t,{angleSum:180,minN:3,maxN:3,repeated:!1}),i=U.random(s);return new this(i,new Z(i,e))}static get commandWord(){return"Find the missing value"}}class K extends H{constructor(t,e){super(t,e),super.scaleToFit(this.width,this.height,40),super.translate(0,-30);const s={textq:this.data.instructions.join("\\\\"),texta:this.data.instructions.join("\\\\"),text:this.data.instructions.join("\\\\"),styleq:"extra-info",stylea:"extra-info",style:"extra-info",pos:new a(10,this.height-10)};this.labels.push(s)}}class J{constructor(t,e,s,i,n){this.angles=t,this.missing=e,this.angleSum=s,this.angleLabels=i,this.instructions=n,this.instructions=n}static random(t){const e=r(t.minN,t.maxN),s=[];for(let t=0;t<e;t++)s[t]=String.fromCharCode(65+t);let i=[],n=[];i.push(new V(1,0));let a=!1,o=0;for(;!a;){o>20&&(i.push(new V(1,0)),a=!0);for(let s=1;s<e;s++){switch(c(t.types)){case"add":{const e=r(t.minAddend,t.maxAddend);i.push(i[s-1].add(e)),n.push(`\\text{Angle $${String.fromCharCode(65+s)}$ is ${tt(e,"+")} angle $${String.fromCharCode(64+s)}$}`);break}case"multiply":{const e=r(t.minMultiplier,t.maxMultiplier);i.push(i[s-1].times(e)),n.push(`\\text{Angle $${String.fromCharCode(65+s)}$ is ${tt(e,"*")} angle $${String.fromCharCode(64+s)}$}`);break}case"percent":{const t=l(5,100,5),e=Math.random()<.5,a=e?1+t/100:1-t/100;i.push(i[s-1].times(a)),n.push(`\\text{Angle $${String.fromCharCode(65+s)}$ is $${t}\\%$ ${e?"bigger":"smaller"} than angle $${String.fromCharCode(64+s)}$}`);break}case"ratio":{const t=r(1,10),e=r(1,10),a=e/t;i.push(i[s-1].times(a)),n.push(`\\text{The ratio of angle $${String.fromCharCode(64+s)}$ to angle $${String.fromCharCode(65+s)}$ is $${t}:${e}$}`)}}}a=!0;const s=i.reduce((t,e)=>t.add(e)),h=V.solve(s,new V(0,t.angleSum));i.forEach((function(e){(!a||e.eval(h)<t.minAngle)&&(a=!1,n=[],i=[i[0]])})),o++}const h=z(i,t.angleSum).angles,d=h.map(()=>!0);return new this(h,d,t.angleSum,s,n)}initLabels(){}}function tt(t,e){switch(e){case"*":switch(t){case 1:return"the same as";case 2:return"double";default:return`$${t}$ times larger than`}case"+":switch(t){case 0:return"the same as";default:return`$${Math.abs(t).toString()}^\\circ$ ${t<0?"less than":"more than"}`}}}class et extends T{static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:25,minN:3,maxN:3,repeated:!1,minAddend:-60,maxAddend:60,minMultiplier:1,maxMultiplier:5,types:["add","multiply","percent","ratio"]},t,{angleSum:180,minN:3,maxN:3,repeated:!1}),i=J.random(s);return new this(i,new K(i,e))}static get commandWord(){return"Find the missing value"}}class st extends W{constructor(t,e){super(t,e),super.translate(0,-15);const s={textq:this.data.instructions.join("\\\\"),texta:this.data.instructions.join("\\\\"),text:this.data.instructions.join("\\\\"),styleq:"extra-info",stylea:"extra-info",style:"extra-info",pos:new a(10,this.height-10)};this.labels.push(s)}}class it extends T{static random(t,e){const s=Object.assign({},{angleSum:180,minAngle:15,minN:2,maxN:2,repeated:!1,minAddend:-90,maxAddend:90,minMultiplier:1,maxMultiplier:5,types:["add","multiply","percent","ratio"]},t),i=J.random(s);return new this(i,new st(i,e))}static get optionsSpec(){return[{type:"select-inclusive",title:"Question types",id:"types",selectOptions:[{title:"More than/less than",id:"add"},{title:"Multiples",id:"multiply"},{title:"Percentage change",id:"percent"},{title:"Ratios",id:"ratio"}],default:["add","multiply"]}]}}class nt extends S{constructor(t){super(),this.question=t}static random(t){if(0===t.types.length)throw new Error("Types list must be non-empty");const e=c(t.types);if(t.custom){const s=[];["simple","repeated","algebra","worded"].forEach(e=>{t[e]&&s.push(e)});const i=c(s);let n={};return"simple"===i||"repeated"===i?n={}:"algebra"===i?n=t.algebraOptions:"worded"===i&&(n=t.wordedOptions),n.minN=t.minN,n.maxN=t.maxN,nt.randomFromTypeWithOptions(e,i,n)}return nt.randomFromDifficulty(e,t.difficulty)}static randomFromDifficulty(t,e){let s;const i={};switch(e){case 1:s="simple",i.minN=2,i.maxN=2;break;case 2:s="simple",i.minN=3,i.maxN=4;break;case 3:s="repeated",i.minN=3,i.maxN=4;break;case 4:s="algebra",i.expressionTypes=["multiply"],i.includeConstants=!1,i.minN=2,i.maxN=4;break;case 5:s="algebra",i.expressionTypes=["add","multiply"],i.includeConstants=["multiply"],i.ensureX=!0,i.minN=2,i.maxN=3;break;case 6:s="algebra",i.expressionTypes=["mixed"],i.minN=2,i.maxN=3;break;case 7:s="worded",i.types=[c(["add","multiply"])],i.minN=i.maxN=2;break;case 8:s="worded",i.types=["add","multiply"],i.minN=i.maxN=3;break;case 9:s="worded",i.types=["multiply","ratio"],i.minN=i.maxN=3;break;case 10:s="worded",i.types=["multiply","add","ratio","percent"],i.minN=i.maxN=3;break;default:throw new Error("Can't generate difficulty "+e)}return this.randomFromTypeWithOptions(t,s,i)}static randomFromTypeWithOptions(t,e,s,i){let n;switch(s=s||{},i=i||{},t){case"aaap":case"aosl":switch(s.angleSum="aaap"===t?360:180,e){case"simple":case"repeated":s.repeated="repeated"===e,n=R.random(s,i);break;case"algebra":n=Y.random(s,i);break;case"worded":n=it.random(s,i);break;default:throw new Error("unexpected subtype "+e)}break;case"triangle":switch(s.repeated="repeated"===e,e){case"simple":case"repeated":n=X.random(s,i);break;case"algebra":n=Q.random(s,i);break;case"worded":n=et.random(s,i);break;default:throw new Error("unexpected subtype "+e)}break;default:throw new Error("Unknown type "+t)}return new nt(n)}getDOM(){return this.question.getDOM()}render(){this.question.render()}showAnswer(){this.question.showAnswer()}hideAnswer(){this.question.hideAnswer()}toggleAnswer(){this.question.toggleAnswer()}static get optionsSpec(){return[{type:"heading",title:""},{title:"Types",id:"types",type:"select-inclusive",selectOptions:[{title:"On a straight line",id:"aosl"},{title:"Around a point",id:"aaap"},{title:"Triangle",id:"triangle"}],default:["aosl","aaap","triangle"],vertical:!0},{type:"column-break"},{type:"bool",title:"<b>Custom settings (disables difficulty)</b>",default:!1,id:"custom"},{type:"range",id:"n-angles",idLB:"minN",idUB:"maxN",defaultLB:2,defaultUB:4,min:2,max:8,title:"Number of angles",enabledIf:"custom"},{type:"bool",title:"Simple",id:"simple",default:!0,enabledIf:"custom"},{type:"bool",title:"Repeated/Isosceles",id:"repeated",default:!0,enabledIf:"custom"},{type:"bool",title:"Algebraic",id:"algebra",default:!0,enabledIf:"custom"},{type:"suboptions",title:"",id:"algebraOptions",optionsSpec:Y.optionsSpec,enabledIf:"custom&algebra"},{type:"bool",title:"Worded",id:"worded",default:!0,enabledIf:"custom"},{type:"suboptions",title:"",id:"wordedOptions",optionsSpec:it.optionsSpec,enabledIf:"custom&worded"}]}static get commandWord(){return"Find the missing value"}static get info(){return"Difficulty levels:\n    <ol>\n      <li> One angle out of two missing\n      <li> One angle out of more than two missing\n      <li> Two or more equal missing angles\n      <li> Simple algebra with missing angles of the form <em>ax</em>\n      <li> Algebra also including angles of the form <em>x+a</em>\n      <li> Algebraic missing angles with any linear expressions for angles\n      <li> &lsquo;Worded&rsquo; questions, e.g &lsquo;Angle <em>A</em> is twice as big as angle <em>B</em>. Two angles only\n      <li> As above with three or more angles\n      <li> Now with ratios!\n      <li> Now with percentage changes! (E.g. &lsquo;Angle <em>A</em> is 20% larger than angle <em>B</em>)\n    </ol>"}}class at{constructor(t,e,s,i,n,a,o,r){this.denominator=1,this.base=t,this.height=e,this.side=s,this.showOpposites=i,this.dp=n,this.denominator=a,this._area=o,this._perimeter=r}static random(t){const e=t.maxLength,s=t.dp,i=t.fraction?r(2,6):1,n={val:r(1,e),show:!0,missing:!1},a={val:r(Math.ceil(n.val/8),2*n.val+Math.ceil(n.val/8),o(2)),show:!0,missing:!1},h={val:r(a.val+1,3*a.val,()=>Math.pow(Math.random(),2)),show:!0,missing:!1},l={show:!1,missing:!1},d={show:!1,missing:!1};[n,a,h].forEach(i>1?t=>{t.label=new O(t.val,i).toLatex(!0)+"\\mathrm{cm}"}:t=>{t.label=g(t.val,s)+"\\mathrm{cm}"});let u=!1;switch(t.questionType){case"area":l.show=!0,l.missing=!0,h.show=!t.noDistractors;break;case"perimeter":d.show=!0,d.missing=!0,u=t.noDistractors,a.show=!t.noDistractors;break;case"reverseArea":l.show=!0,l.missing=!1,c([n,a]).missing=!0;break;case"reversePerimeter":default:d.show=!0,d.missing=!1,c([n,h]).missing=!0}return new at(n,a,h,u,s,i,l,d)}get perimeter(){return this._perimeter||(this._perimeter={show:!1,missing:!0}),this._perimeter.val||(this._perimeter.val=2*(this.base.val+this.side.val),this.denominator>1?this._perimeter.label=new O(this._perimeter.val,this.denominator).toLatex(!0)+"\\mathrm{cm}":this._perimeter.label=g(this._perimeter.val,this.dp)+"\\mathrm{cm}"),this._perimeter}get area(){return this._area||(this._area={show:!1,missing:!0}),this._area.val||(this._area.val=this.base.val*this.height.val,this.denominator>1?this._area.label=new O(this._area.val,Math.pow(this.denominator,2)).toLatex(!0)+"\\mathrm{cm}^2":this._area.label=g(this._area.val,2*this.dp)+"\\mathrm{cm}^2"),this._area}}function ot(t,e,s,i,n=.5){const o=a.unitVector(e,s);o.x*=i,o.y*=i;const r={x:-o.y,y:o.x};r.x*=n,r.y*=n;const h=s.clone().translate(-o.x,-o.y).translate(r.x,r.y),l=s.clone().translate(-o.x,-o.y).translate(-r.x,-r.y);t.moveTo(e.x,e.y),t.lineTo(s.x,s.y),t.lineTo(h.x,h.y),t.moveTo(s.x,s.y),t.lineTo(l.x,l.y)}function rt(t,e,s,i,n){const o=a.unitVector(s,e),r=a.unitVector(s,i),h=s.clone().translate(o.x*n,o.y*n),l=h.clone().translate(r.x*n,r.y*n),c=s.clone().translate(r.x*n,r.y*n);t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.lineTo(c.x,c.y)}function ht(t,e,s,i=10,n=1,o=i){const r=a.unitVector(e,s);r.x*=i,r.y*=i;const h={x:-r.y,y:r.x},l=a.mean(e,s);for(let e=0;e<n;e++){const i=l.clone().moveToward(s,e*o),n=i.clone().translate(-r.x,-r.y).translate(h.x,h.y),a=i.clone().translate(-r.x,-r.y).translate(-h.x,-h.y);t.moveTo(n.x,n.y),t.lineTo(i.x,i.y),t.lineTo(a.x,a.y)}}const lt=["LightCyan","LightYellow","Pink","LightGreen","LightBlue","Ivory","LightGray"];class ct extends E{constructor(t,e,s,i,n,a,o,r,h){super(r,h),this.A=t,this.B=e,this.C=s,this.D=i,this.ht1=n,this.ht2=a,this.labels=o}static fromData(t,e){var s,i,n,o,r,h;(e=null!=e?e:{}).width=null!==(s=e.width)&&void 0!==s?s:300,e.height=null!==(i=e.height)&&void 0!==i?i:300;const l=e.width,c=e.height,d=t.side.val,u=t.base.val,m=t.height.val,p=new a(0,0),f=new a(Math.sqrt(d*d-m*m),m),g=f.clone().translate(u,0),v=new a(u,0),w=g.clone(),x=g.clone().translate(0,-m);w.moveToward(f,-u/10),x.moveToward(p,-u/10);const y=null!==(n=null==e?void 0:e.rotation)&&void 0!==n?n:2*Math.random()*Math.PI;[p,f,g,v,w,x].forEach(t=>{t.rotate(y)}),a.scaleToFit([p,f,g,v,w,x],l,c,100,[0,20]);const b=[],C=[[p,f,t.side],[v,p,t.base],[w,x,t.height]];t.showOpposites&&(C.push([f,g,t.base]),C.push([g,v,t.side]));for(let t=0,e=C.length;t<e;t++){if(!C[t][2].show)continue;const e=25;let s=a.mean(C[t][0],C[t][1]);const i=a.unitVector(C[t][0],C[t][1]);s.translate(-i.y*e,i.x*e);const n=null!==(o=C[t][2].label)&&void 0!==o?o:C[t][2].val.toString(),r=C[t][2].missing?"?":n,h="normal",l=C[t][2].missing?"answer":"normal";b.push({pos:s,texta:n,textq:r,text:r,stylea:l,styleq:h,style:h})}let M=0;if(t.area.show){const e=null!==(r=t.area.label)&&void 0!==r?r:t.area.val.toString(),s=t.area.missing?"?":e,i="extra-info",n=t.area.missing?"extra-answer":"extra-info";b.push({texta:"\\text{Area} = "+e,textq:"\\text{Area} = "+s,text:"\\text{Area} = "+s,styleq:i,stylea:n,style:i,pos:new a(10,c-10-15*M)}),M++}if(t.perimeter.show){const e=null!==(h=t.perimeter.label)&&void 0!==h?h:t.perimeter.val.toString(),s=t.perimeter.missing?"?":e,i="extra-info",n=t.perimeter.missing?"extra-answer":"extra-info";b.push({pos:new a(10,c-10-20*M),texta:"\\text{Perimeter} = "+e,textq:"\\text{Perimeter} = "+s,text:"\\text{Perimeter} = "+s,styleq:i,stylea:n,style:i})}return new ct(p,f,g,v,w,x,b,t,e)}render(){const t=this.canvas.getContext("2d");if(!t)throw new Error("Could not get canvas context");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.setLineDash([]),t.beginPath(),t.moveTo(this.A.x,this.A.y),t.lineTo(this.B.x,this.B.y),t.lineTo(this.C.x,this.C.y),t.lineTo(this.D.x,this.D.y),t.lineTo(this.A.x,this.A.y),t.stroke(),t.fillStyle=c(lt),t.fill(),t.closePath(),t.beginPath(),ht(t,this.A,this.B,5),ht(t,this.D,this.C,5),ht(t,this.B,this.C,5,2),ht(t,this.A,this.D,5,2),t.stroke(),t.closePath(),this.data.height.show&&(t.beginPath(),ot(t,a.mean(this.ht1,this.ht2),this.ht1,8),ot(t,a.mean(this.ht1,this.ht2),this.ht2,8),t.stroke(),t.closePath(),t.beginPath(),t.setLineDash([5,3]),t.moveTo(this.D.x,this.D.y),t.lineTo(this.ht2.x,this.ht2.y),t.stroke(),t.closePath(),t.beginPath(),t.setLineDash([]),rt(t,this.ht1,this.ht2,this.D,12),t.stroke(),t.closePath()),this.renderLabels()}}class dt extends T{static random(t,e){const s=at.random(t);return new this(s,ct.fromData(s,e))}static get commandWord(){return"Find the missing values"}}class ut extends E{constructor(t,e,s,i,n,a,o){super(a,o),this.A=t,this.B=e,this.C=s,this.D=i,this.labels=n}static fromData(t,e){var s,i,n,o,r,h;(e=null!=e?e:{}).width=null!==(s=e.width)&&void 0!==s?s:300,e.height=null!==(i=e.height)&&void 0!==i?i:300;const l=new a(0,0),c=new a(0,t.height.val),d=new a(t.base.val,t.height.val),u=new a(t.base.val,0),m=null!==(n=e.rotation)&&void 0!==n?n:2*Math.PI*Math.random();[l,c,d,u].forEach(t=>t.rotate(m)),a.scaleToFit([l,c,d,u],e.width,e.height,100,[0,20]);const p=[],f=[[l,c,t.height],[c,d,t.base]];t.showOpposites&&(f.push([d,u,t.height]),f.push([u,l,t.base]));for(let t=0,e=f.length;t<e;t++){if(!f[t][2].show)continue;const e=20,s=a.mean(f[t][0],f[t][1]),i=a.unitVector(f[t][0],f[t][1]);s.translate(-i.y*e,i.x*e);const n=null!==(o=f[t][2].label)&&void 0!==o?o:f[t][2].val.toString(),r=f[t][2].missing?"?":n,h="normal",l=f[t][2].missing?"answer":"normal";p.push({pos:s,texta:n,textq:r,text:r,stylea:l,styleq:h,style:h})}let g=0;if(t.area.show){const s=null!==(r=t.area.label)&&void 0!==r?r:t.area.val.toString(),i=t.area.missing?"?":s,n="extra-info",o=t.area.missing?"extra-answer":"extra-info";p.push({texta:"\\text{Area} = "+s,textq:"\\text{Area} = "+i,text:"\\text{Area} = "+i,styleq:n,stylea:o,style:n,pos:new a(10,e.height-10-15*g)}),g++}if(t.perimeter.show){const s=null!==(h=t.perimeter.label)&&void 0!==h?h:t.perimeter.val.toString(),i=t.perimeter.missing?"?":s,n="extra-info",o=t.perimeter.missing?"extra-answer":"extra-info";p.push({pos:new a(10,e.height-10-20*g),texta:"\\text{Perimeter} = "+s,textq:"\\text{Perimeter} = "+i,text:"\\text{Perimeter} = "+i,styleq:n,stylea:o,style:n})}return new ut(l,c,d,u,p,t,e)}render(){const t=this.canvas.getContext("2d");if(null===t)throw new Error("Could not get context");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.setLineDash([]),t.beginPath(),t.moveTo(this.A.x,this.A.y),t.lineTo(this.B.x,this.B.y),t.lineTo(this.C.x,this.C.y),t.lineTo(this.D.x,this.D.y),t.lineTo(this.A.x,this.A.y),t.stroke(),t.fillStyle=c(lt),t.fill(),t.closePath();const e=Math.min(15,Math.min(a.distance(this.A,this.B),a.distance(this.B,this.C))/3);t.beginPath(),rt(t,this.A,this.B,this.C,e),rt(t,this.B,this.C,this.D,e),rt(t,this.C,this.D,this.A,e),rt(t,this.D,this.A,this.B,e),t.stroke(),t.closePath(),this.renderLabels()}}class mt extends T{static random(t,e){const s=class{constructor(t,e,s,i,n,a,o){this.denominator=1,this.base=t,this.height=e,this.showOpposites=s,this.dp=i,this.denominator=n,this._area=a,this._perimeter=o}static random(t){t.maxLength=t.maxLength||20;const e=t.dp||0,s=t.fraction?r(2,6):1,i={base:r(1,t.maxLength),height:r(1,t.maxLength)},n={val:i.base,show:!0,missing:!1,label:g(i.base,e)+"\\mathrm{cm}"},a={val:i.height,show:!0,missing:!1,label:g(i.height,e)+"\\mathrm{cm}"};let o;s>1&&[n,a].forEach(t=>{t.label=new O(t.val,s).toLatex(!0)+"\\mathrm{cm}"});const h={},l={};switch(t.questionType){case"area":h.show=!0,h.missing=!0,o=!t.noDistractors;break;case"perimeter":l.show=!0,l.missing=!0,o=t.noDistractors;break;case"reverseArea":h.show=!0,h.missing=!1,c([n,a]).missing=!0,o=!1;break;case"reversePerimeter":default:l.show=!0,l.missing=!1,c([n,a]).missing=!0,o=!1}return new this(n,a,o,e,s,h,l)}get perimeter(){return this._perimeter||(this._perimeter={show:!1,missing:!0}),this._perimeter.val||(this._perimeter.val=2*(this.base.val+this.height.val),this.denominator>1?this._perimeter.label=new O(this._perimeter.val,this.denominator).toLatex(!0)+"\\mathrm{cm}":this._perimeter.label=g(this._perimeter.val,this.dp)+"\\mathrm{cm}"),this._perimeter}get area(){return this._area||(this._area={show:!1,missing:!0}),this._area.val||(this._area.val=this.base.val*this.height.val,this.denominator>1?this._area.label=new O(this._area.val,Math.pow(this.denominator,2)).toLatex(!0)+"\\mathrm{cm}^2":this._area.label=g(this._area.val,2*this.dp)+"\\mathrm{cm}^2"),this._area}}.random(t);return new this(s,ut.fromData(s,e))}static get commandWord(){return"Find the missing values"}}class pt{constructor(t,e,s,i,n,a,o,r,h,l,c){this.dp=0,this.denominator=1,this.a=t,this.b=e,this.height=s,this.side1=i,this.side2=n,this.b1=a,this.b2=o,this.dp=r,this.denominator=h,this._perimeter=l,this._area=c}get perimeter(){return this._perimeter||(this._perimeter={show:!1,missing:!0}),this._perimeter.val||(this._perimeter.val=this.a.val+this.b.val+this.side1.val+this.side2.val,this.denominator>1?this._perimeter.label=new O(this._perimeter.val,this.denominator).toLatex(!0)+"\\mathrm{cm}":this._perimeter.label=g(this._perimeter.val,this.dp)+"\\mathrm{cm}"),this._perimeter}get area(){return this._area||(this._area={show:!1,missing:!0}),this._area.val||(this._area.val=this.height.val*(this.a.val+this.b.val)/2,this.denominator>1?this._area.label=new O(this._area.val,Math.pow(this.denominator,2)).toLatex(!0)+"\\mathrm{cm}^2":this._area.label=g(this._area.val,2*this.dp)+"\\mathrm{cm}^2"),this._area}static random(t){const e=t.dp,s=t.fraction?r(2,6):1;let i,n,a,o,h,l,d,p,f;p=function(t){const e=r(2,Math.ceil(Math.sqrt(t))-1),s=r(1,Math.min(e-1,Math.floor(Math.sqrt(t-e*e))));return{a:e*e-s*s,b:2*e*s,c:e*e+s*s}}(t.maxLength),a=p.c,Math.random()<.5?(h=p.a,l=p.b):(h=p.b,l=p.a),Math.random()<.9?(f=function(t,e){if(void 0===e&&(e=500),t%2==1)return m(t,e);{let s,i,n;Math.random()<.5?(i=u,n=m):(n=u,i=m);try{s=i(t,e)}catch(i){s=n(t,e)}return s}}(h,t.maxLength),o=f.c,d=f.b):(o=h,d=0);const v=Math.min(t.maxLength-l-d,8*h),w=Math.ceil((l+d)/7);i=v-w<1?Math.floor(w):r(w,v),n=l+d+i;const x={val:i,show:!0,missing:!1},y={val:n,show:!0,missing:!1},b={val:h,show:o!==h,missing:!1},C={val:a,show:!0,missing:!1},M={val:o,show:!0,missing:!1},L={show:!1,missing:!1},S={show:!1,missing:!1};switch(t.questionType){case"area":L.show=!0,L.missing=!0;break;case"perimeter":S.show=!0,S.missing=!0;break;case"reverseArea":L.show=!0,L.missing=!1,Math.random()<.3?b.missing=!0:Math.random()<.5?y.missing=!0:x.missing=!0;break;case"reversePerimeter":default:S.show=!0,S.missing=!1,c([C,M,x,y]).missing=!0}return[x,y,C,M,b].forEach(1===s?t=>{t.label=g(t.val,e)+"\\mathrm{cm}"}:t=>{t.label=new O(t.val,s).toLatex(!0)+"\\mathrm{cm}"}),t.noDistractors&&("area"===t.questionType||"reverseArea"===t.questionType?(C.show=!1,M.show=!b.show):"perimeter"!==t.questionType&&"reversePerimeter"!==t.questionType||(b.show=!1)),new pt(x,y,b,C,M,l,d,e,s,S,L)}}class ft extends E{constructor(t,e,s,i,n,a,o,r,h){super(t,e),this.A=s,this.B=i,this.C=n,this.D=a,this.ht1=o,this.ht2=r,this.labels=h}static fromData(t,e){var s,i,n,o,r,h;(e=null!=e?e:{}).width=null!==(s=e.width)&&void 0!==s?s:300,e.height=null!==(i=e.height)&&void 0!==i?i:300;const l=new a(0,0),c=new a(t.b1,t.height.val),d=new a(t.b1+t.a.val,t.height.val),u=new a(t.b.val,0),m=new a(t.b1+t.a.val/2,t.height.val),p=new a(t.b1+t.a.val/2,0),f=null!==(n=e.rotation)&&void 0!==n?n:2*Math.PI*Math.random();[l,c,d,u,m,p].forEach(t=>t.rotate(f)),a.scaleToFit([l,c,d,u,m,p],e.width,e.height,100,[0,20]);const g=[],v=[[l,c,t.side1],[c,d,t.a],[d,u,t.side2],[u,l,t.b],[m,p,t.height]];for(let t=0,e=v.length;t<e;t++){if(!v[t][2].show)continue;const e=25;let s=a.mean(v[t][0],v[t][1]);const i=a.unitVector(v[t][0],v[t][1]);s.translate(-i.y*e,i.x*e);const n=null!==(o=v[t][2].label)&&void 0!==o?o:v[t][2].val.toString(),r=v[t][2].missing?"?":n,h="normal",l=v[t][2].missing?"answer":"normal";g.push({pos:s,texta:n,textq:r,text:r,stylea:l,styleq:h,style:h})}let w=0;if(t.area.show){const s=null!==(r=t.area.label)&&void 0!==r?r:t.area.val.toString(),i=t.area.missing?"?":s,n="extra-info",o=t.area.missing?"extra-answer":"extra-info";g.push({texta:"\\text{Area} = "+s,textq:"\\text{Area} = "+i,text:"\\text{Area} = "+i,styleq:n,stylea:o,style:n,pos:new a(10,e.height-10-20*w)}),w++}if(t.perimeter.show){const s=null!==(h=t.perimeter.label)&&void 0!==h?h:t.perimeter.val.toString(),i=t.perimeter.missing?"?":s,n="extra-info",o=t.perimeter.missing?"extra-answer":"extra-info";g.push({pos:new a(10,e.height-10-20*w),texta:"\\text{Perimeter} = "+s,textq:"\\text{Perimeter} = "+i,text:"\\text{Perimeter} = "+i,styleq:n,stylea:o,style:n})}return new ft(t,e,l,c,d,u,m,p,g)}render(){const t=this.canvas.getContext("2d");if(!t)throw new Error("Could not get canvas context");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.setLineDash([]),t.beginPath(),t.moveTo(this.A.x,this.A.y),t.lineTo(this.B.x,this.B.y),t.lineTo(this.C.x,this.C.y),t.lineTo(this.D.x,this.D.y),t.lineTo(this.A.x,this.A.y),t.stroke(),t.fillStyle=c(lt),t.fill(),t.closePath(),t.beginPath(),ht(t,this.B,this.ht1,5),ht(t,this.A,this.ht2,5),t.stroke(),t.closePath(),this.data.height.show&&(t.beginPath(),ot(t,a.mean(this.ht1,this.ht2),this.ht1,8),ot(t,a.mean(this.ht1,this.ht2),this.ht2,8),t.stroke(),t.closePath(),t.beginPath(),t.setLineDash([]),rt(t,this.ht1,this.ht2,this.D,12),t.stroke(),t.closePath()),this.data.height.val===this.data.side2.val&&(t.beginPath(),rt(t,this.B,this.C,this.D,12),rt(t,this.C,this.D,this.A,12),t.stroke()),this.renderLabels()}}class gt extends T{static random(t,e){const s=pt.random(t);return new this(s,ft.fromData(s,e))}static get commandWord(){return"Find the missing values"}}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */function vt(t,e,s,i){return new(s||(s=Promise))((function(n,a){function o(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}h((i=i.apply(t,e||[])).next())}))}const wt={100:{length:361,path:"/data/triangles0-100.json",status:"uncached",data:[],queue:[]},200:{length:715,path:"/data/triangles100-200.json",status:"uncached",data:[],queue:[]},300:{length:927,path:"/data/triangles200-300.json",status:"uncached",data:[],queue:[]},400:{length:1043,path:"/data/triangles300-400.json",status:"uncached",data:[],queue:[]},500:{length:1151,path:"/data/triangles400-500.json",status:"uncached",data:[],queue:[]}};function xt(t){return Math.max(t.b,t.s1,t.s2)}class yt{constructor(t,e,s,i,n,a,o,r){this.denominator=1,this.base=t,this.side1=e,this.side2=s,this.height=i,this.dp=n,this.denominator=a,this._area=o,this._perimeter=r}get perimeter(){return this._perimeter||(this._perimeter={show:!1,missing:!0}),this._perimeter.val||(this._perimeter.val=this.base.val+this.side1.val+this.side2.val,this.denominator>1?this._perimeter.label=new O(this._perimeter.val,this.denominator).toLatex(!0)+"\\mathrm{cm}":this._perimeter.label=g(this._perimeter.val,this.dp)+"\\mathrm{cm}"),this._perimeter}get area(){return this._area||(this._area={show:!1,missing:!0}),this._area.val||(this._area.val=this.base.val*this.height.val/2,this.denominator>1?this._area.label=new O(this._area.val,Math.pow(this.denominator,2)).toLatex(!0)+"\\mathrm{cm}^2":this._area.label=g(this._area.val,2*this.dp)+"\\mathrm{cm}^2"),this._area}isRightAngled(){return bt({b:this.base.val,h:this.height.val,s1:this.side1.val,s2:this.side2.val})}static random(t){return vt(this,void 0,void 0,(function*(){t.maxLength=t.maxLength||20;const e=t.dp||0,s=t.fraction?r(2,6):1,i="pythagorasIsoscelesArea"===t.questionType,n="pythagorasArea"===t.questionType||"pythagorasPerimeter"===t.questionType,a=yield function(t,e){let s;e=null!=e?e:t=>!0,t>500&&(t=500);const i=l(0,t-1,50)+50,n=(100*Math.ceil(i/100)).toString(),a=wt[n];return"cached"===a.status?(s=c(a.data.filter(s=>xt(s)<t&&e(s))),Promise.resolve(s)):"pending"===a.status?new Promise((s,i)=>{a.queue.push({callback:s,maxLength:t,filter:e})}):(a.status="pending",fetch("."+a.path).then(t=>t.ok?t.json():Promise.reject(t.statusText)).then(i=>(a.data=i,a.status="cached",a.queue.forEach(({callback:t,maxLength:e,filter:s})=>{s=null!=s?s:t=>!0,t(c(i.filter(t=>xt(t)<e&&s(t))))}),s=c(i.filter(s=>xt(s)<t&&e(s))),s)))}(t.maxLength,t=>(!i||function(t){return t.s1===t.s2}(t))&&(!n||bt(t))),o=bt(a),h={val:a.b,show:!0,missing:!1},d={val:a.h,show:!o,missing:!1},u={val:a.s1,show:!0,missing:!1},m={val:a.s2,show:!0,missing:!1};[h,d,u,m].forEach(t=>{t.label=1===s?g(t.val,e)+"\\mathrm{cm}":new O(t.val,s).toLatex(!0)+"\\mathrm{cm}"});const p=h,f=u.val>m.val?m:u,v=u.val>m.val?u:m,w={show:!1,missing:!0},x={show:!1,missing:!0};switch(t.questionType){case"area":w.show=!0,w.missing=!0;break;case"perimeter":x.show=!0,x.missing=!0;break;case"reverseArea":{w.show=!0,w.missing=!1;const t=Math.random()<.5;o?t?p.missing=!0:f.missing=!0:t?h.missing=!0:d.missing=!0;break}case"reversePerimeter":x.show=!0,x.missing=!1,c([h,u,m]).missing=!0;break;case"pythagorasArea":if(!o)throw new Error("Should have RA triangle here");w.show=!0,w.missing=!0,c([p,f]).show=!1;break;case"pythagorasPerimeter":if(!o)throw new Error("Should have RA triangle here");x.show=!0,x.missing=!0,c([p,f,v]).show=!1;break;case"pythagorasIsoscelesArea":default:w.show=!0,w.missing=!0,d.show=!1}return new yt(h,u,m,d,e,s,w,x)}))}}function bt(t){return t.s1===t.h||t.s2===t.h}class Ct extends E{constructor(t,e,s,i,n,a){super(t,e),this.A=s,this.B=i,this.C=n,this.labels=null!=a?a:[]}render(){return vt(this,void 0,void 0,(function*(){const t=x("div","loader",this.DOM);if(void 0===this.A&&(yield this.init()),!(this.A&&this.B&&this.C&&this.ht))throw new Error("Intialisation failed. Points are: "+[this.A,this.B,this.C,this.ht]);if(this.data instanceof Promise)throw new Error("Initialisation failed: data is still a Promise");const e=this.canvas.getContext("2d");if(null===e)throw new Error("Could not get canvas context");e.clearRect(0,0,this.canvas.width,this.canvas.height),e.setLineDash([]),e.beginPath(),e.moveTo(this.A.x,this.A.y),e.lineTo(this.B.x,this.B.y),e.lineTo(this.C.x,this.C.y),e.lineTo(this.A.x,this.A.y),e.stroke(),e.fillStyle=c(lt),e.fill(),e.closePath(),this.data.height.show&&(e.beginPath(),ot(e,a.mean(this.C,this.ht).moveToward(this.C,15),this.C,10),ot(e,a.mean(this.C,this.ht).moveToward(this.ht,15),this.ht,10),e.stroke(),e.closePath()),(this.data.isRightAngled()||this.data.height.show)&&(e.beginPath(),this.A.equals(this.ht)?rt(e,this.B,this.ht,this.C,15):rt(e,this.A,this.ht,this.C,15),e.stroke(),e.closePath()),this.data.height.show&&this.overhangRight&&(e.beginPath(),e.setLineDash([5,3]),e.moveTo(this.B.x,this.B.y),e.lineTo(this.ht.x,this.ht.y),e.stroke(),e.closePath()),this.data.height.show&&this.overhangLeft&&(e.beginPath(),e.setLineDash([5,3]),e.moveTo(this.A.x,this.A.y),e.lineTo(this.ht.x,this.ht.y),e.stroke(),e.closePath()),this.renderLabels(!1,!0),t.remove()}))}init(){var t,e,s,i;return vt(this,void 0,void 0,(function*(){this.data=yield this.data;const n=this.data.height.val,o=this.data.base.val,r=this.data.side1.val,h=this.data.side2.val;this.A=new a(0,n),this.B=new a(o,n),this.C=new a((o*o+r*r-h*h)/(2*o),0),this.ht=new a(this.C.x,this.A.y),this.overhangRight=!1,this.overhangLeft=!1,this.C.x>this.B.x&&(this.overhangRight=!0),this.C.x<this.A.x&&(this.overhangLeft=!0),this.rotation=null!==(t=this.rotation)&&void 0!==t?t:2*Math.PI*Math.random(),[this.A,this.B,this.C,this.ht].forEach(t=>t.rotate(this.rotation)),a.scaleToFit([this.A,this.B,this.C,this.ht],this.width,this.height,100,[0,20]);const l=[[this.A,this.B,this.data.base],[this.C,this.A,this.data.side1],[this.B,this.C,this.data.side2]];this.ht.equals(this.B)?l.push([this.ht,this.C,this.data.height]):l.push([this.C,this.ht,this.data.height]);for(let t=0;t<4;t++){if(!l[t][2].show)continue;const s=20,i=a.mean(l[t][0],l[t][1]),n=a.unitVector(l[t][0],l[t][1]);t<3&&i.translate(-n.y*s,n.x*s);const o=null!==(e=l[t][2].label)&&void 0!==e?e:l[t][2].val.toString(),r=l[t][2].missing?"?":o,h=3===t?"normal repel-locked":"normal",c=l[t][2].missing?3===t?"answer repel-locked":"answer":3===t?"normal repel-locked":"normal";this.labels.push({pos:i,texta:o,textq:r,text:r,stylea:c,styleq:h,style:h})}let c=0;if(this.data.area.show){const t=null!==(s=this.data.area.label)&&void 0!==s?s:this.data.area.val.toString(),e=this.data.area.missing?"?":t,i="extra-info",n=this.data.area.missing?"extra-answer":"extra-info";this.labels.push({texta:"\\text{Area} = "+t,textq:"\\text{Area} = "+e,text:"\\text{Area} = "+e,styleq:i,stylea:n,style:i,pos:new a(10,this.height-10-15*c)}),c++}if(this.data.perimeter.show){const t=null!==(i=this.data.perimeter.label)&&void 0!==i?i:this.data.perimeter.val.toString(),e=this.data.perimeter.missing?"?":t,s="extra-info",n=this.data.perimeter.missing?"extra-answer":"extra-info";this.labels.push({pos:new a(10,this.height-10-20*c),texta:"\\text{Perimeter} = "+t,textq:"\\text{Perimeter} = "+e,text:"\\text{Perimeter} = "+e,styleq:s,stylea:n,style:s})}}))}static fromAsyncData(t,e){return new this(t,e)}}class Mt extends T{static random(t,e){const s=yt.random(t);return new this(s,Ct.fromAsyncData(s,e))}static get commandWord(){return"Find the missing values"}}function Lt(t,e="reverse"){return e+t[0].toUpperCase()+t.slice(1)}function St(t){var e,s;const i=x("div","barModel-outer"),n=x("div","barModel-total",i),a=(x("div","barModel-bracket",i),x("div","barModel-bar",i));return t.parts.forEach(t=>{var e,s;const i=x("div","barModel-part",a);t.style&&i.classList.add(t.style),i.style.flexGrow=t.length.toString(),t.latex?katex.render(null!==(e=t.label)&&void 0!==e?e:t.length.toString(),i):i.innerHTML=null!==(s=t.label)&&void 0!==s?s:t.length.toString()}),t.total.latex?katex.render(null!==(e=t.total.label)&&void 0!==e?e:t.total.length.toString(),n):n.innerHTML=null!==(s=t.total.label)&&void 0!==s?s:t.total.length.toString(),i}const At=[2,3,5,7,11,13,17,19,23,29,31,37,31,43,47];function kt(t){let e=t.toLatex(!0);return e.startsWith("-")||(e="+"+e),e}function qt(t,e,s=!1){let i=!1;e.compare(0)<0&&(i=!0,e=e.neg());return(i?"-":s?"":"+")+(1===t?"":t.toString()+"\\times")+e.toLatex(!0)}function Et(t){return e=>1===v(e,t)}function Tt({denominators:t,maxDenominator:e,maxIntegerPart:s,minIntegerPart:i,simplify:n,subtract:a,n:o=2}){let l=[];switch(t){case"same":{const t=!0===n?h(4,e,t=>!At.includes(t)):!1===n?h(5,e,t=>At.includes(t)):r(4,e),o=(s+1)*t-1,c=i?i*t:1;let d,u;if(a)d=h(Math.max(c,2),o,Et(t)),u=-h(1,d-1,Et(t));else{d=h(c,o-1,Et(t));const e=!0===n?e=>Et(t)(e)&&!Et(t)(d+e):!1===n?e=>Et(t)(e)&&Et(t)(d+e):e=>Et(t)(e);try{u=h(c,o-d,e)}catch(t){if("overfiltered"!==t.message)throw t;u=o-d+1}}l.push(new O(d,t)),l.push(new O(u,t));break}case"multiple":{const t=r(2,Math.ceil(Math.sqrt(e))),i=r(2,Math.floor(e/t)),n=i*t,o=(s+1)*t-1;let c,d;Math.random()<.5?(c=h(1,o,e=>1===v(e,t)),d=a?-h(1,i*c-1,t=>1===v(t,n)):h(1,n-i*c-1,t=>1===v(t,n)),l.push(new O(c,t)),l.push(new O(d,n))):(c=a?h(i+1,n-1,t=>1===v(t,n)):h(1,n-i-1,t=>1===v(t,n)),d=a?-h(1,Math.floor(c/i),e=>1===v(e,t)):h(1,t-Math.ceil(c/i),e=>1===v(e,t)),l.push(new O(c,n)),l.push(new O(d,t)));break}case"sharedFactor":{const t=r(2,Math.ceil(Math.sqrt(e))),n=r(2,Math.floor(e/t)),c=h(2,Math.floor(e/t),t=>1===v(n,t)),d=t*n,u=t*c,m=s>1?(s+1)*d-1:Math.floor(n*t-n/c),p=i?i*d:1,f=(s+1)*u-1,g=i?i*u:1,w=s>1?1/0:t*n*c-1;let x,y;a?(x=h(Math.max(Math.ceil(n/c),p),m,t=>1===v(t,d)),y=-h(1,f,t=>1===v(t,u)&&c*x-n*t>0)):(x=h(p,m,t=>1===v(t,u)),y=h(g,f,t=>1===v(t,u)&&x*c+t*n<=w)),l.push(new O(x,d)),l.push(new O(y,u));for(let i=2;i<o;i++){const i=t*r(1,Math.floor(e/t)),n=(s+1)*i-1,a=h(-n,n,t=>0!==t);l.push(new O(a,i))}}}return l}function Bt(t){return void 0!==t.id}const Pt=[{section:"Number"},{id:"integer-add",title:"Integer addition",class:class extends A{constructor(t){super();const e=Object.assign({},{difficulty:5,label:"a"},t);this.label=e.label;const s=r(10,1e3),i=r(10,1e3),n=s+i;this.questionLaTeX=s+" + "+i,this.answerLaTeX="= "+n,this.render()}static get commandWord(){return"Evaluate"}}},{id:"fraction-add",title:"Fractions +/-",class:class extends A{static random(t){let e,s;if(t.difficulty&&t.difficulty<8){let i;switch(t.difficulty){case 1:i=Tt({denominators:"same",maxDenominator:19,maxIntegerPart:0,simplify:!1,subtract:Math.random()<.5});break;case 2:i=Tt({denominators:"same",maxDenominator:20,maxIntegerPart:0,simplify:!0,subtract:Math.random()<.5});break;case 3:i=Tt({denominators:"multiple",maxDenominator:20,maxIntegerPart:0,simplify:void 0,subtract:Math.random()<.5});break;case 4:i=Tt({denominators:"sharedFactor",maxDenominator:12,maxIntegerPart:0,simplify:void 0,subtract:Math.random()<.5});break;case 5:i=Tt({denominators:"same",maxDenominator:10,minIntegerPart:1,maxIntegerPart:3,simplify:void 0,subtract:Math.random()<.5});break;case 6:i=Tt({denominators:"sharedFactor",maxDenominator:12,maxIntegerPart:3,minIntegerPart:1,simplify:void 0,subtract:Math.random()<.5});break;case 7:default:i=Tt({denominators:"sharedFactor",maxDenominator:12,n:3,maxIntegerPart:3,minIntegerPart:1,simplify:void 0,subtract:Math.random()<.5})}e=i[0].toLatex(!0)+i.slice(1).map(kt).join(""),s="="+i.reduce((t,e)=>t.add(e)).toLatex(!0)}else{let i,n;switch(t.difficulty){case 8:i=Tt({denominators:"sharedFactor",maxDenominator:12,maxIntegerPart:3,minIntegerPart:1,simplify:void 0,subtract:Math.random()<.5}),n=[1,1],n[r(0,1)]=r(2,4);break;case 9:i=Tt({denominators:"sharedFactor",maxDenominator:12,maxIntegerPart:3,minIntegerPart:1,simplify:void 0,subtract:Math.random()<.5}),n=[r(2,4),r(2,4)];break;case 10:default:i=Tt({denominators:"sharedFactor",maxDenominator:24,maxIntegerPart:5,minIntegerPart:1,simplify:void 0,subtract:Math.random()<.5}),n=[r(2,4),r(2,4)]}e="";let a=new O(0);for(let t=0;t<i.length;t++)e+=qt(n[t],i[t],0===t),a=a.add(i[t].add(n[t]));s="="+a.toLatex(!0)}return new this(e,s,{questionClass:"adjacent",answerClass:"adjacent"})}static get info(){return"Difficulty settings: \n  <ol>\n   <li> Same denominator, proper fractions, no simplifying\n   <li> Same denominator, proper fractions, needs simplifying\n   <li> One denominator is a multiple of another\n   <li> Different denominators, proper fractions (N.B. denominators always share a factor, to discourage cross multiplying )\n   <li> Small mixed numbers, same denominator\n   <li> Mixed numbers with different denominators\n   <li> Three fractions or mixed numbers\n   <li> One fraction is multiplied by an integer\n   <li> Both fractions are multiplied by an integer\n   <li> Big numbers"}static get commandWord(){return"Calculate"}}},{id:"barmodel",title:"Partition problems (bar models)",class:class extends S{constructor(t,e){super(),this.questionSpec=t,this.answerSpec=e}static random(t){let e,s,i;switch(t.difficulty){case 1:e=10,s=10,i=2;break;case 2:e=7,s=30,i=2;break;case 3:e=20,s=100,i=2;case 4:e=20,s=200,i=3;break;case 5:e=20,s=200,i=r(2,4);break;case 6:case 7:case 8:case 9:case 10:default:e=100,s=1e3,i=r(3,4)}const n=r(e,s),a=d({total:n,n:i,minProportion:.1}),o={total:{length:n},parts:a.map(t=>({length:t}))},h={total:{length:n},parts:a.map(t=>({length:t}))};if(Math.random()<.5)o.total.label="?",h.total.style="answer";else{const t=r(0,i-1);h.parts[t].style="answer",o.parts[t].label="?"}return new this(o,h)}render(){var t,e;if(this.DOM.innerHTML="",this.answered){const t=null!==(e=this._answerDiv)&&void 0!==e?e:this._answerDiv=St(this.answerSpec);this.DOM.append(t)}else{const e=null!==(t=this._questionDiv)&&void 0!==t?t:this._questionDiv=St(this.questionSpec);this.DOM.append(e)}}showAnswer(){super.showAnswer(),this.render()}hideAnswer(){super.hideAnswer(),this.render()}}},{section:"Algebra"},{id:"algebraic-fraction",title:"Simplify algebraic fractions",class:class extends A{constructor(t){super();const e=Object.assign({},{difficulty:2},t);var s,i,n,a,o,h,l,c,d,u,m,p,f;switch(e.difficulty){case 1:u=1,m=1,p=1,f=6;break;case 2:u=1,m=1,p=-6,f=6;break;case 3:u=1,m=3,p=-5,f=5;break;case 4:default:u=-3,m=3,p=-5,f=5}for(;!s&&!i||!n&&!a||!o&&!h||q(s,i,n,a);)s=r(u,m),n=r(u,m),o=r(u,m),i=r(p,f),a=r(p,f),h=r(p,f);n<=0&&a<=0&&(n=-n,a=-a,s=-s,i=-i),l=n*o,c=n*h+a*o,d=a*h;const g=`\\frac{${k(s*o,s*h+i*o,i*h)}}{${k(l,c,d)}}`;e.useCommandWord?this.questionLaTeX="\\text{Simplify} "+g:this.questionLaTeX=g,this.answerLaTeX=0===n&&1===a?k(0,s,i):`\\frac{${k(0,s,i)}}{${k(0,n,a)}}`,this.answerLaTeX="= "+this.answerLaTeX}static get commandWord(){return"Simplify"}}},{id:"equation-of-line",title:"Equation of a line (from two points)",class:class extends A{constructor(t){super();const e=Object.assign({},{difficulty:2},t),s=Math.ceil(e.difficulty/2);let i,n,a,o,h,l,c,d,u,m;switch(s){case 1:case 2:case 3:if(c=s<3?1:-5,d=5,u=s<2?0:-10,m=10,i=r(c,5),n=r(u,10),a=s<3?r(0,10):r(-15,15),o=i*a+n,s<3)h=r(a+1,15);else for(h=a;h===a;)h=r(-15,15);l=i*h+n;break;case 4:default:{const t=r(1,5),e=r(-5,5);i=new O(e,t),a=new O(r(-10,10)),o=new O(r(-10,10)),n=new O(o).sub(i.mul(a)),h=a.add(r(1,5)*i.d),l=i.mul(h).add(n);break}}const p=0===i||i.equals&&i.equals(0)?"":1===i||i.equals&&i.equals(1)?"x":-1===i||i.equals&&i.equals(-1)?"-x":i.toLatex?i.toLatex()+"x":i+"x",f=0===n||n.equals&&n.equals(0)?"":n<0?" - "+(n.neg?n.neg().toLatex():-n):n.toLatex?" + "+n.toLatex():" + "+n;this.questionLaTeX="("+a+", "+o+")\\text{ and }("+h+", "+l+")",this.answerLaTeX="y = "+p+f}static get commandWord(){return"Find the equation of the line through"}}},{section:"Geometry"},{id:"missing-angles",title:"Missing angles",class:nt},{id:"area-perimter",title:"Area and perimeter of shapes",class:class extends S{constructor(t){super(),this.question=t,this.DOM=t.DOM}static random(t){const e=c(t.shapes);return this.randomFromDifficulty(t.difficulty,e,t.questionTypesSimple)}static randomFromDifficulty(t,e,s){const i={questionType:c(s),dp:0,fraction:!1,noDistractors:!0,maxLength:20};switch(t){case 1:break;case 2:i.noDistractors=!1;break;case 3:i.noDistractors=!1,i.maxLength=100;break;case 4:Math.random()<.5?(i.dp=1,i.maxLength=99):(i.fraction=!0,i.maxLength=15),i.noDistractors=!1;break;case 5:Math.random()<.5?(i.dp=1,i.maxLength=500):(i.fraction=!0,i.maxLength=100),i.noDistractors=!1;break;case 6:i.dp=0,i.noDistractors=!1,i.questionType=c(s.map(t=>Lt(t))),i.maxLength=20;break;case 7:i.dp=0,i.noDistractors=!1,i.questionType=c(s.map(t=>Lt(t))),i.maxLength=99;break;case 8:i.dp=1,i.noDistractors=!1,i.questionType=c(s.map(t=>Lt(t))),i.maxLength=99;break;case 9:i.dp=1,i.noDistractors=!1,i.questionType=c(s.map(t=>Lt(t))),i.maxLength=500;break;case 10:default:e="triangle",i.questionType=c(["pythagorasArea","pythagorasIsoscelesArea","pythagorasPerimeter"])}return this.randomWithOptions(e,i,{})}static randomWithOptions(t,e,s){let i;switch(t){case"rectangle":i=mt.random(e,s);break;case"triangle":i=Mt.random(e,s);break;case"trapezium":i=gt.random(e,s);break;case"parallelogram":i=dt.random(e,s);break;default:throw new Error("Not yet implemented")}return new this(i)}render(){this.question.render()}showAnswer(){this.question.showAnswer()}hideAnswer(){this.question.hideAnswer()}toggleAnswer(){this.question.toggleAnswer()}static get optionsSpec(){return[{id:"shapes",type:"select-inclusive",selectOptions:[{id:"rectangle",title:"Rectangles"},{id:"triangle",title:"Triangles"},{id:"parallelogram",title:"Parallelograms"},{id:"trapezium",title:"Trapezia"}],default:["rectangle","triangle","parallelogram","trapezium"],title:"Shapes"},{id:"questionTypesSimple",type:"select-inclusive",selectOptions:[{id:"area",title:"Area"},{id:"perimeter",title:"Perimeter"}],default:["area","perimeter"],title:"Type of question"}]}static get commandWord(){return"Find the missing value"}}},{section:"Other"},{id:"arithmagon-add",title:"Arithmagons",class:D}];function Ot(t){for(let e=0;e<Pt.length;e++){const s=Pt[e];if(Bt(s)&&s.id===t)return s.class}return null}function _t(t){const e=Ot(t);return null===e?"":e.commandWord}var Nt=P((function(t,e){t.exports=function(){var t=!1;function e(t){this.opts=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]}({},{onClose:null,onOpen:null,beforeOpen:null,beforeClose:null,stickyFooter:!1,footer:!1,cssClass:[],closeLabel:"Close",closeMethods:["overlay","button","escape"]},t),this.init()}function s(){this.modalBoxFooter&&(this.modalBoxFooter.style.width=this.modalBox.clientWidth+"px",this.modalBoxFooter.style.left=this.modalBox.offsetLeft+"px")}return e.prototype.init=function(){if(!this.modal)return function(){this.modal=document.createElement("div"),this.modal.classList.add("tingle-modal"),0!==this.opts.closeMethods.length&&-1!==this.opts.closeMethods.indexOf("overlay")||this.modal.classList.add("tingle-modal--noOverlayClose"),this.modal.style.display="none",this.opts.cssClass.forEach((function(t){"string"==typeof t&&this.modal.classList.add(t)}),this),-1!==this.opts.closeMethods.indexOf("button")&&(this.modalCloseBtn=document.createElement("button"),this.modalCloseBtn.type="button",this.modalCloseBtn.classList.add("tingle-modal__close"),this.modalCloseBtnIcon=document.createElement("span"),this.modalCloseBtnIcon.classList.add("tingle-modal__closeIcon"),this.modalCloseBtnIcon.innerHTML='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M.3 9.7c.2.2.4.3.7.3.3 0 .5-.1.7-.3L5 6.4l3.3 3.3c.2.2.5.3.7.3.2 0 .5-.1.7-.3.4-.4.4-1 0-1.4L6.4 5l3.3-3.3c.4-.4.4-1 0-1.4-.4-.4-1-.4-1.4 0L5 3.6 1.7.3C1.3-.1.7-.1.3.3c-.4.4-.4 1 0 1.4L3.6 5 .3 8.3c-.4.4-.4 1 0 1.4z" fill="#000" fill-rule="nonzero"/></svg>',this.modalCloseBtnLabel=document.createElement("span"),this.modalCloseBtnLabel.classList.add("tingle-modal__closeLabel"),this.modalCloseBtnLabel.innerHTML=this.opts.closeLabel,this.modalCloseBtn.appendChild(this.modalCloseBtnIcon),this.modalCloseBtn.appendChild(this.modalCloseBtnLabel)),this.modalBox=document.createElement("div"),this.modalBox.classList.add("tingle-modal-box"),this.modalBoxContent=document.createElement("div"),this.modalBoxContent.classList.add("tingle-modal-box__content"),this.modalBox.appendChild(this.modalBoxContent),-1!==this.opts.closeMethods.indexOf("button")&&this.modal.appendChild(this.modalCloseBtn),this.modal.appendChild(this.modalBox)}.call(this),function(){this._events={clickCloseBtn:this.close.bind(this),clickOverlay:function(t){var e=this.modal.offsetWidth-this.modal.clientWidth,s=t.clientX>=this.modal.offsetWidth-15,i=this.modal.scrollHeight!==this.modal.offsetHeight;"MacIntel"===navigator.platform&&0==e&&s&&i||-1!==this.opts.closeMethods.indexOf("overlay")&&!function(t,e){for(;(t=t.parentElement)&&!t.classList.contains(e););return t}(t.target,"tingle-modal")&&t.clientX<this.modal.clientWidth&&this.close()}.bind(this),resize:this.checkOverflow.bind(this),keyboardNav:function(t){-1!==this.opts.closeMethods.indexOf("escape")&&27===t.which&&this.isOpen()&&this.close()}.bind(this)},-1!==this.opts.closeMethods.indexOf("button")&&this.modalCloseBtn.addEventListener("click",this._events.clickCloseBtn),this.modal.addEventListener("mousedown",this._events.clickOverlay),window.addEventListener("resize",this._events.resize),document.addEventListener("keydown",this._events.keyboardNav)}.call(this),document.body.appendChild(this.modal,document.body.firstChild),this.opts.footer&&this.addFooter(),this},e.prototype._busy=function(e){t=e},e.prototype._isBusy=function(){return t},e.prototype.destroy=function(){null!==this.modal&&(this.isOpen()&&this.close(!0),function(){-1!==this.opts.closeMethods.indexOf("button")&&this.modalCloseBtn.removeEventListener("click",this._events.clickCloseBtn),this.modal.removeEventListener("mousedown",this._events.clickOverlay),window.removeEventListener("resize",this._events.resize),document.removeEventListener("keydown",this._events.keyboardNav)}.call(this),this.modal.parentNode.removeChild(this.modal),this.modal=null)},e.prototype.isOpen=function(){return!!this.modal.classList.contains("tingle-modal--visible")},e.prototype.open=function(){if(!this._isBusy()){this._busy(!0);var t=this;return"function"==typeof t.opts.beforeOpen&&t.opts.beforeOpen(),this.modal.style.removeProperty?this.modal.style.removeProperty("display"):this.modal.style.removeAttribute("display"),this._scrollPosition=window.pageYOffset,document.body.classList.add("tingle-enabled"),document.body.style.top=-this._scrollPosition+"px",this.setStickyFooter(this.opts.stickyFooter),this.modal.classList.add("tingle-modal--visible"),"function"==typeof t.opts.onOpen&&t.opts.onOpen.call(t),t._busy(!1),this.checkOverflow(),this}},e.prototype.close=function(t){if(!this._isBusy()){if(this._busy(!0),"function"==typeof this.opts.beforeClose&&!this.opts.beforeClose.call(this))return void this._busy(!1);document.body.classList.remove("tingle-enabled"),document.body.style.top=null,window.scrollTo({top:this._scrollPosition,behavior:"instant"}),this.modal.classList.remove("tingle-modal--visible");var e=this;e.modal.style.display="none","function"==typeof e.opts.onClose&&e.opts.onClose.call(this),e._busy(!1)}},e.prototype.setContent=function(t){return"string"==typeof t?this.modalBoxContent.innerHTML=t:(this.modalBoxContent.innerHTML="",this.modalBoxContent.appendChild(t)),this.isOpen()&&this.checkOverflow(),this},e.prototype.getContent=function(){return this.modalBoxContent},e.prototype.addFooter=function(){return function(){this.modalBoxFooter=document.createElement("div"),this.modalBoxFooter.classList.add("tingle-modal-box__footer"),this.modalBox.appendChild(this.modalBoxFooter)}.call(this),this},e.prototype.setFooterContent=function(t){return this.modalBoxFooter.innerHTML=t,this},e.prototype.getFooterContent=function(){return this.modalBoxFooter},e.prototype.setStickyFooter=function(t){return this.isOverflow()||(t=!1),t?this.modalBox.contains(this.modalBoxFooter)&&(this.modalBox.removeChild(this.modalBoxFooter),this.modal.appendChild(this.modalBoxFooter),this.modalBoxFooter.classList.add("tingle-modal-box__footer--sticky"),s.call(this),this.modalBoxContent.style["padding-bottom"]=this.modalBoxFooter.clientHeight+20+"px"):this.modalBoxFooter&&(this.modalBox.contains(this.modalBoxFooter)||(this.modal.removeChild(this.modalBoxFooter),this.modalBox.appendChild(this.modalBoxFooter),this.modalBoxFooter.style.width="auto",this.modalBoxFooter.style.left="",this.modalBoxContent.style["padding-bottom"]="",this.modalBoxFooter.classList.remove("tingle-modal-box__footer--sticky"))),this},e.prototype.addFooterBtn=function(t,e,s){var i=document.createElement("button");return i.innerHTML=t,i.addEventListener("click",s),"string"==typeof e&&e.length&&e.split(" ").forEach((function(t){i.classList.add(t)})),this.modalBoxFooter.appendChild(i),i},e.prototype.resize=function(){},e.prototype.isOverflow=function(){return window.innerHeight<=this.modalBox.clientHeight},e.prototype.checkOverflow=function(){this.modal.classList.contains("tingle-modal--visible")&&(this.isOverflow()?this.modal.classList.add("tingle-modal--overflow"):this.modal.classList.remove("tingle-modal--overflow"),!this.isOverflow()&&this.opts.stickyFooter?this.setStickyFooter(!1):this.isOverflow()&&this.opts.stickyFooter&&(s.call(this),this.setStickyFooter(!0)))},{modal:e}}()}));window.SHOW_DIFFICULTY=!1,x("div","overlay hidden",document.body).addEventListener("click",It);class Dt{constructor(t){this.questions=[],this.topics=[],this.optionsSets={},this.qNumber=t||1,this.answered=!1,this.commandWord="",this.sharedCommandWord=!0,this.n=8,this._build()}_build(){this.outerBox=x("div","question-outerbox"),this.headerBox=x("div","question-headerbox",this.outerBox),this.displayBox=x("div","question-displaybox",this.outerBox),this._buildOptionsBox(),this._buildTopicChooser()}_buildOptionsBox(){const t=x("span",void 0,this.headerBox);this.topicChooserButton=x("span","topic-chooser button",t),this.topicChooserButton.innerHTML="Choose topic",this.topicChooserButton.addEventListener("click",()=>this.chooseTopics());const e=x("span",void 0,this.headerBox);e.append("Difficulty: ");const s=x("span","slider-outer",e);this.difficultySliderElement=x("input",void 0,s);const i=x("span",void 0,this.headerBox);i.append("Number of questions: ");const n=x("input","n-questions",i);n.type="number",n.min="1",n.value="8",n.addEventListener("change",()=>{this.n=parseInt(n.value)}),this.generateButton=x("button","generate-button button",this.headerBox),this.generateButton.disabled=!0,this.generateButton.innerHTML="Generate!",this.generateButton.addEventListener("click",()=>this.generateAll())}_initSlider(){this.difficultySlider=new t({target:this.difficultySliderElement,values:{min:1,max:10},range:!0,set:[2,6],step:1,tooltip:!1,scale:!0,labels:!0})}_buildTopicChooser(){const t=Pt.map(t=>Bt(t)?{title:t.title,id:t.id}:t),e=[];t.forEach(t=>{"section"in t?e.push({type:"heading",title:t.section}):e.push({title:t.title,id:t.id,type:"bool",default:!1,swapLabel:!0})}),this.topicsOptions=new M(e),this.topicsModal=new Nt.modal({footer:!0,stickyFooter:!1,closeMethods:["overlay","escape"],closeLabel:"Close",onClose:()=>{this.updateTopics()}}),this.topicsModal.addFooterBtn("OK","button modal-button",()=>{this.topicsModal.close()}),this.topicsOptions.renderIn(this.topicsModal.getContent());Array.from(this.topicsModal.getContent().getElementsByTagName("li")).forEach(t=>{const e=t.dataset.optionId;if(void 0!==e){if(function(t){const e=Ot(t);return null!==e&&!!(e.optionsSpec&&e.optionsSpec.length>0)}(e)){const s=x("div","icon-button inline extra-options",t);this._buildTopicOptions(e,s)}const s=function(t){const e=Ot(t);if(null!==e)return e.info}(e);if(s){const e=x("div","icon-button inline topic-info",t);e.innerText="ⓘ";const i=new Nt.modal({stickyFooter:!1,closeMethods:["overlay","escape"],closeLabel:"Close"});i.setContent(s),e.addEventListener("click",()=>i.open())}}})}_buildTopicOptions(t,e){const s=function(t){var e;const s=(null===(e=Ot(t))||void 0===e?void 0:e.optionsSpec)||[];return new M(s)}(t);this.optionsSets[t]=s;const i=new Nt.modal({footer:!0,stickyFooter:!1,closeMethods:["overlay","escape"],closeLabel:"Close"});i.addFooterBtn("OK","button modal-button",()=>{i.close()}),s.renderIn(i.getContent()),e.addEventListener("click",()=>{i.open()})}chooseTopics(){this.topicsModal.open()}updateTopics(){var t;const e=function(t){const e=[];for(const s in t)t[s]&&e.push(s);return e}(this.topicsOptions.options);let s;if(this.topics=e,0===e.length)s="Choose topic",this.generateButton.disabled=!0;else{s=null!==(t=function(t){const e=Pt.find(e=>Bt(e)&&e.id===t);return void 0!==e&&Bt(e)?e.title:void 0}(e[0]))&&void 0!==t?t:"",this.generateButton.disabled=!1}e.length>1&&(s+=" +"+(e.length-1)),this.topicChooserButton.innerHTML=s}setCommandWord(){let t=_t(this.topics[0]),e=!0;for(let s=1;s<this.topics.length;s++)if(_t(this.topics[s])!==t){t="",e=!1;break}this.commandWord=t,this.sharedCommandWord=e}generateAll(){this.displayBox.innerHTML="",this.questions=[],this.setCommandWord();x("p","katex mainq",this.displayBox).innerHTML=`${this.qNumber}. ${this.commandWord}`,this.answerButton=x("p","button show-answers",this.displayBox),this.answerButton.addEventListener("click",()=>{this.toggleAnswers()}),this.answerButton.innerHTML="Show answers",this.answered=!1;const t=this.difficultySlider.getValueL(),e=this.difficultySlider.getValueR();let s=0;for(let i=0;i<this.n;i++){const n=x("div","question-container",this.displayBox);n.dataset.question_index=i+"",this.questions[i]||(this.questions[i]={container:n});const a=t+Math.floor(i*(e-t+1)/this.n);s=Math.max(s,this.generate(i,a))}const i=Math.max(180,s);this.displayBox.style.setProperty("--column-width",i+"px")}generate(t,e,s){s=s||c(this.topics);const i={label:"",difficulty:e,useCommandWord:!1};this.optionsSets[s]&&Object.assign(i,this.optionsSets[s].options);const n=function(t,e){const s=Ot(t);let i;return s&&"random"in s?i=s.random(e):s&&(i=new s(e)),i}(s,i);if(!n)throw new Error("Unable to make question with id "+s);if(!this.questions[t])throw new Error("question not made");this.questions[t].question=n,this.questions[t].topicId=s;const a=this.questions[t].container;a.innerHTML="";let o=function(t){return t<26?String.fromCharCode(97+t):t<52?String.fromCharCode(65+t-26):String.fromCharCode(945+t-52)}(t)+")";window.SHOW_DIFFICULTY&&(o+=i.difficulty),this.sharedCommandWord?a.classList.remove("individual-command-word"):(o+=" "+_t(s),a.classList.add("individual-command-word"));const r=x("div","question-number katex",a);r.innerHTML=o,a.appendChild(n.getDOM()),n.render();const h=this.sharedCommandWord?r.clientWidth+n.getDOM().clientWidth:n.getDOM().clientWidth,l=x("div","question-actions hidden",a),d=x("div","question-refresh icon-button",l);return x("div","question-answer icon-button",l).addEventListener("click",()=>{n.toggleAnswer(),It()}),d.addEventListener("click",()=>{this.generate(t,e),It()}),a.addEventListener("mouseenter",()=>{this.showQuestionActions(t)}),a.addEventListener("mouseleave",()=>{It()}),h}toggleAnswers(){this.answered?this.questions.forEach(t=>{t.question&&t.question.hideAnswer(),this.answered=!1,this.answerButton.innerHTML="Show answers"}):this.questions.forEach(t=>{t.question&&t.question.showAnswer(),this.answered=!0,this.answerButton.innerHTML="Hide answers"})}adjustGridWidth(){}showQuestionActions(t){It();const e=this.questions[t].container,s=e.querySelector(".question-actions"),i=document.querySelector(".overlay");null!==i&&i.classList.remove("hidden"),s.classList.remove("hidden"),s.style.left=e.offsetWidth/2-s.offsetWidth/2+"px",s.style.top=e.offsetHeight/2-s.offsetHeight/2+"px"}appendTo(t){t.appendChild(this.outerBox),this._initSlider()}appendBefore(t,e){t.insertBefore(this.outerBox,e),this._initSlider()}}function It(){document.querySelectorAll(".question-actions").forEach(t=>{t.classList.add("hidden")});const t=document.querySelector(".overlay");if(null===t)throw new Error("Could not find overlay when hiding actions");t.classList.add("hidden")}document.addEventListener("DOMContentLoaded",()=>{const t=new Dt;t.appendTo(document.body),t.chooseTopics(),document.getElementById("fullscreen").addEventListener("click",t=>{document.fullscreenElement?document.exitFullscreen().then(()=>{t.target.innerText="Full screen"}):document.documentElement.requestFullscreen().then(()=>{t.target.innerText="Exit full screen"})});let e=!1;document.getElementById("hide-controls").addEventListener("click",t=>{e?([...document.getElementsByClassName("question-headerbox")].forEach(t=>{t.classList.remove("hidden")}),t.target.innerText="Hide controls",e=!1):([...document.getElementsByClassName("question-headerbox")].forEach(t=>{t.classList.add("hidden")}),t.target.innerText="Show controls",e=!0)})})}();
